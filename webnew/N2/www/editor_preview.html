<!DOCTYPE HTML>
<html>
<head>
	<meta charset = "utf-8" />
	<meta name = "format-detection" content = "telephone = no" />
	<meta name = "msapplication-tap-highlight" content = "no" />
	<meta name = "viewport" content="initial-scale=1, minimum-scale=1" />

	<link rel = "stylesheet" href = "js/plugin/viewjs-1.6.3/view-1.6.3.min.css"/>

	<title>View.js</title>
</head>
<body>

	<script type = "text/javascript" class = "viewjs">
		var ajax = function(url, ops){
			ops = ops || {};

			var xhr = new XMLHttpRequest();
			xhr.open("GET", url);
			xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

			xhr.onreadystatechange = function(){
				if(this.readyState !== 4)
					return;

				ops.oncomplete && ops.oncomplete(this.responseText, this.status);

				if(this.status === 200){
					ops.onsuccess && ops.onsuccess.call(window, this.responseText);
				}else
					ops.onfailure && ops.onfailure.call(window, this.responseText, this.status);
			};
			xhr.send();
		};

		window.apply = function(html, css, js){
			if(null != html && (html = String(html).trim()) !== ""){
				var scriptObj = document.querySelector("script.viewjs");

				var tmpObj = document.createElement("div");
				tmpObj.innerHTML = html;
				var childNodes = tmpObj.childNodes;
				var arr = [];
				Array.prototype.forEach.call(childNodes, function(obj){
					arr.push(obj);
				});
				arr.forEach(function(obj){
					document.body.insertBefore(obj, scriptObj);
				});
			}

			if(null != css && (css = String(css).trim()) !== ""){
				var styleObj = document.createElement("style");
				styleObj.innerHTML = css;
				document.head.appendChild(styleObj);
			}

			ajax("js/plugin/viewjs-1.6.3/view-1.6.3.min.js", {
				onsuccess: function(responseText){
					eval(responseText);
					View.setInitializer(function(init){
						init();

						if(null != js && (js = String(js).trim()) !== ""){
							eval(js);
						}
					}, "rightnow");
				}
			});
		};
	</script>
</body>
</html>