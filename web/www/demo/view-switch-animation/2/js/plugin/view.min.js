/**
 * View.js v1.6.2
 * author: Billy, wmjhappy_ok@126.com
 * license: MIT
 * 
 * -- 2019-12-06 12:38
 */
!function(e,t){if("View"in e)return void console.error("Plugin name: 'View' has already been used");e.View={}}(window),function(e,t){var i=function(e,t){this.type=e,this.timestamp=(new Date).getTime(),this.data=t,Object.freeze&&Object.freeze(this)},n=function(e,t){var n={},r=function(e){n[e]=n[e]||[]};e.on=function(e,t){String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){r(e),n[e].indexOf(t)===-1&&n[e].push(t)})},e.off=function(e,t){String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){r(e);var i=n[e].indexOf(t);i!==-1&&n[e].splice(i,1)})},e.fire=function(e,a,o){arguments.length<3&&(o=!0),String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){var s=new i(e,a),u=function(){r(e);for(var i=0;i<n[e].length;i++){var a=n[e][i];if("function"==typeof a)try{a.call(t,s)}catch(e){console.error(e,e.stack)}}};o?setTimeout(u,0):u()})}};e.View.eventDrive=n}(window),function(e,t){var i=function(){var e,t,i=function(){if(0!=arguments.length){var e=arguments,t=" "+String(arguments[0]),i=1;return t=t.replace(/([^\\])\{\}/g,function(t,n){var a=e.length-1<i?"{}":String(r(e[i]));return i++,n+a}),t=t.replace(/\\\{\}/g,"{}"),t.substring(1)}},n=function(){var e=new Date,t=(e.getFullYear(),"0"+String(e.getMonth()+1));t=t.substring(t.length-2);var i="0"+String(e.getDate());i=i.substring(i.length-2);var n="0"+String(e.getHours());n=n.substring(n.length-2);var r="0"+String(e.getMinutes());r=r.substring(r.length-2);var a="0"+String(e.getSeconds());return a=a.substring(a.length-2),t+i+" "+n+":"+r+":"+a},r=function(e){if(null==e)return null;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e)return e;if("function"==typeof e)return"function "+e.name+"(){...}";if("object"!=typeof e||Array.isArray(e))return e instanceof Array?"["+e.map(function(e){return r(e)}).join(", ")+"]":e;if("[object Object]"!=String(e))return String(e);var t=JSON.stringify(e);if("{}"!=t)return t;try{var i={};for(var n in e)i[n]=r(e[n]);return JSON.stringify(i)}catch(e){return t}},a=function(e){return n()+" ["+e+"]: "},o={};!function(){var i=!0;e=function(){return i},t=function(e){i=e}}();var s=function(t){var n=!0;this.isEnabled=function(){return e()&&n},this.setIsEnabled=function(e){return n=e,this},this.getName=function(){return t},this.debug=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.debug(a(t)+e)}},this.info=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.info(a(t)+e)}},this.warn=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.warn(a(t)+e)}},this.error=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.error(a(t)+e)}},this.log=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.log(a(t)+e)}}},u=function(e){if(e in o)return o[e];var t=new s(e);return o[e]=t,t};return s.ofName=u,s.isGloballyEnabled=e,s.setIsGloballyEnabled=t,s}();i.globalLogger=i.ofName("View"),e.View.Logger=i}(window),function(ctx,name){var globalLogger=ctx.View.Logger.globalLogger,setDftValue=function(e,t,i){arguments.length<3&&(i=!1),e=e||{},t=t||{};for(var n in t)n in e&&!(n in e&&null==e[n]&&i)||(e[n]=t[n]);return e},defineReadOnlyProperty=function(e,t,i){Object.defineProperty(e,t,{value:i,configurable:!1,writable:!1,enumerable:!0})},try2Apply=function(e,t,i){if(null!=e&&"function"==typeof e)try{e.apply(t,i)}catch(t){var n=t instanceof Error||null!=t&&"object"==typeof t&&"stack"in t,r="Error occured while executing function: {}. {}"+(n?" stack:\n{}":"");globalLogger.error(r,e.name,t,n?t.stack:null)}},try2Call=function(func,ctx,args){if(null!=func&&"function"==typeof func)try{var len=arguments.length;if(1===len)return func();if(2===len)return func.call(ctx);if(3===len)return func.call(ctx,arguments[2]);if(4===len)return func.call(ctx,arguments[2],arguments[3]);if(5===len)return func.call(ctx,arguments[2],arguments[3],arguments[4]);if(6===len)return func.call(ctx,arguments[2],arguments[3],arguments[4],arguments[5]);if(7===len)return func.call(ctx,arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);for(var tmp="",index=2,i=2;i<arguments.length;i++)tmp+=",arguments["+i+"]";var rst;return void eval("rst = func.call(ctx"+tmp+")")}catch(e){return void console.error("Error occured while executing function: "+func.name,e,e.stack)}},isEmptyString=function(e,t){return arguments.length<2&&(t=!1),null===e||void 0===e||(e=String(e),t&&(e=e.trim()),0===e.length)},isNullOrUndefined=function(e){return null===e||void 0===e},ifStringEquals=function(e,t,i,n){return arguments.length<4&&(n=!0),arguments.length<3&&(i=!0),isNullOrUndefined(e)?!!isNullOrUndefined(t):!isNullOrUndefined(t)&&(n&&(e=String(e).trim(),t=String(t).trim()),i||(e=e.toLowerCase(),t=t.toLowerCase()),e===t)},ifStringEqualsIgnoreCase=function(e,t,i){return arguments.length<3&&(i=!0),ifStringEquals(e,t,!1,i)},randomString=function(){var e="0123456789abcdefghijklmnopqrstuvwxyz";return function(t){arguments.length<1&&(t="");for(var i=10,n="";i-- >0;){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}return t+n}}(),xEncodeURIComponent=function(e){return encodeURIComponent(String(e)).replace(/\+/gm,"%2B")},getUniqueString=function(){var e=0;return function(){var t=Date.now(),i=t.toString(36),n="00"+(e++).toString(36);return n=n.substring(n.length-2),(i+n).toUpperCase()}}(),getComputedStyle=function(e){return window.getComputedStyle?window.getComputedStyle(e):e.currentStyle},env=function(){var e=navigator.userAgent,t={},i=function(){return e=navigator.userAgent,t.isUC=/(?:UCWEB|UCBrowser)/.test(e),t.isSafari=/(?:Safari)/.test(e),t.isOpera=/(?:Opera Mini)/.test(e),t.isTencent=/(?:MQQBrowser|QQ|MicroMessenger)/.test(e),t.isTencentMiniProgram=t.isTencent&&(/(?:miniprogram)/i.test(e)||"miniprogram"===window.__wxjs_environment),t.isIOS=/(?:Mac OS)/.test(e),t.isAndroid=/(?:Android)/.test(e),t.isWindowsPhone=/(?:Windows Phone)/.test(e),t.isIPad=t.isIOS&&/(?:iPad)/.test(e),t.isIPhone=t.isIOS&&/(?:iPhone)/.test(e),t.isTablet=/(?:Tablet|PlayBook)/.test(e)||t.isIPad,t.isMobile=/(?:Mobile)/.test(e)&&!t.isIPad||t.isWindowsPhone,t.isPc=!t.isMobile&&!t.isTablet,t.isHistoryPushPopSupported="pushState"in history&&"function"==typeof history.pushState,t};return t.refresh=i,i(),t}(),parseParams=function(e){if(isEmptyString(e,!0))return null;var t=null,i=e.split(/\s*&\s*/);return 0!==i.length&&(t={},i.forEach(function(e){var i=e.split(/\s*=\s*/);t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])})),t},blurInputs=function(){for(var e=document.querySelectorAll("input, select, textarea, *[contentEditable]"),t=0;t<e.length;t++)e[t].blur()};ctx.View.util={setDftValue:setDftValue,defineReadOnlyProperty:defineReadOnlyProperty,try2Apply:try2Apply,try2Call:try2Call,isEmptyString:isEmptyString,isNullOrUndefined:isNullOrUndefined,ifStringEquals:ifStringEquals,ifStringEqualsIgnoreCase:ifStringEqualsIgnoreCase,randomString:randomString,xEncodeURIComponent:xEncodeURIComponent,getUniqueString:getUniqueString,getComputedStyle:getComputedStyle,parseParams:parseParams,blurInputs:blurInputs,env:env}}(window,"View"),function(e,t){var i=e.View.util,n=e.View.Logger,r=n.globalLogger,a=document.documentElement,o=0,s=0,u=0,l=0,c=null,f=null,g=[],d=function(){return o<=s},w=function(e){g.indexOf(e)===-1&&g.push(e)},h=function(e){for(var t=0;t<g.length;t++)i.try2Call(g[t],null,e)},p=function(){var e=a.clientWidth,t=a.clientHeight,n=window.innerWidth||e,g=window.innerHeight||t,w=d();i.env.refresh();var p=i.env.isPc,v=!1,m=[];p!==f&&(v=!0,m.push("env")),Math.abs(n-o)>.5?(v=!0,m.push("width")):g-s>.5&&(v=!0,m.push("height+")),u=e,l=t,o=n,s=g,c=w,f=p,v&&(r.debug("Resolution changes. Changed aspects: {}",m),h())};p(),setInterval(p,20);var v={addChangeListener:w};Object.freeze&&Object.freeze(v),e.View.resolution=v}(window),function(e,t){var i=e.View.Logger.globalLogger,n=e.View.util,r=e.View.resolution,a=function(){var e=320/568,t=!0,a=[],o=!1,s={},u=document.documentElement,l=function(){return u.querySelector("[data-view-container]")||document.body},c=function(){var e=l(),t=n.getComputedStyle(e),i=Number(t.paddingLeft.replace(/px/,"")),r=Number(t.paddingRight.replace(/px/,""));return isNaN(i)&&(i=0),isNaN(r)&&(r=0),e.clientWidth-i-r},f=function(){var e=l(),t=n.getComputedStyle(e),i=Number(t.paddingTop.replace(/px/,"")),r=Number(t.paddingBottom.replace(/px/,""));return isNaN(i)&&(i=0),isNaN(r)&&(r=0),e.clientHeight-i-r},g=function(){return window.innerWidth||u.clientWidth},d=function(){return window.innerHeight||u.clientHeight},w=function(){return c()<=f()},h=function(){return!w()},p=function(){return g()<=d()},v=function(){return!p()},m=function(){return g()/d()},y=function(){return g()/d()},V=function(){return e},S=function(t){return e=t,s},b=function(e,t){var i=this,n=i.style;n.width=e+"px",n.height=t+"px"},E=b,A=E,I=A,P=E,C=P,_=I,N=_,O=E,T=O,L=I,R=L,W=function(){var e=g(),t=d(),i=v()?I:E;n.try2Call(i,l(),e,t)},x=function(){var e=g(),t=d(),i=v()?N:C;n.try2Call(i,l(),e,t)},D=function(){var t=g(),i=d();p()?n.try2Call(T,l(),t,i):R===L?(t=i*e,n.try2Call(E,l(),t,i)):n.try2Call(R,l(),t,i)},H=function(e){if(a.indexOf(e)===-1)return a.push(e),s},$=function(e){var t=a.indexOf(e);if(t!==-1)return a.splice(t,1),s},k=function(){var e=c(),t=f();return function(i){arguments.length<1&&(i=!0),n.env.isPc?D():n.env.isTablet?x():W();var r=c(),o=f(),u=g(),l=d();if(Math.abs(e-r)>=.1||Math.abs(t-o)>=.1){var w=function(){for(var e=0;e<a.length;e++){var t=a[e];"function"==typeof t&&n.try2Call(t,null,r,o,u,l)}};i?setTimeout(w,0):w()}return s}}(),q=function(e){return o?(i.warn("Layout was initialized already"),s):(o=!0,e=n.setDftValue(e,{autoReLayoutWhenResize:!0,layoutAsMobilePortrait:E,layoutAsMobileLandscape:I,layoutAsTabletLandscape:N,layoutAsTabletPortrait:C,layoutAsPcPortrait:T,layoutAsPcLandscape:R}),t=!!e.autoReLayoutWhenResize,t&&r.addChangeListener(k),"function"==typeof e.layoutAsMobilePortrait&&(E=e.layoutAsMobilePortrait),"function"==typeof e.layoutAsMobileLandscape&&(I=e.layoutAsMobileLandscape),"function"==typeof e.layoutAsTabletPortrait&&(C=e.layoutAsTabletPortrait),"function"==typeof e.layoutAsTabletLandscape&&(N=e.layoutAsTabletLandscape),"function"==typeof e.layoutAsPcPortrait&&(T=e.layoutAsPcPortrait),"function"==typeof e.layoutAsPcLandscape&&(R=e.layoutAsPcLandscape),s)};return(0,n.setDftValue)(s,{getLayoutWidth:c,getLayoutHeight:f,getBrowserWidth:g,getBrowserHeight:d,isLayoutPortrait:w,isLayoutLandscape:h,isBrowserPortrait:p,isBrowserLandscape:v,getLayoutWidthHeightRatio:m,getBrowserWidthHeightRatio:y,getExpectedWidthHeightRatio:V,setExpectedWidthHeightRatio:S,init:q,doLayout:k,addLayoutChangeListener:H,removeLayoutChangeListener:$}),Object.freeze&&Object.freeze(s),s}();e.View.layout=a}(window),function(e,t){var i=e.View.util,n=function(){var e=/mobile|tablet|ip(ad|hone|od)|android/i,t=(window,e.test(navigator.userAgent)),n="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ",r=function(e,t){return e=e||{},e[t]=e[t]||{},e[t]};return{addTapListener:function(e,a,o){if(!t)return void(e.addEventListener?e.addEventListener("click",a):e.attachEvent("onclick",a));var s=r(e,n+".tap");if(s.callbacks=s.callbacks||[],s.callbacks.indexOf(a)==-1){s.callbacks.push(a),o=i.setDftValue(o,{timespan:500,delta:{},useCapture:!1}),o.delta=i.setDftValue(o.delta,{x:10,y:15});var u=r(e,n+".tap.meta");null==u.touchstart&&(u.touchstart=function(e){var t=e.changedTouches?e.changedTouches[0]:e;s.startX=t.screenX,s.startY=t.screenY,s.startTimestamp=Date.now()},e.addEventListener("touchstart",u.touchstart)),null==u.touchend&&(u.touchend=function(t){var n=t.changedTouches?t.changedTouches[0]:t;s.stopX=n.screenX,s.stopY=n.screenY,s.stopTimestamp=Date.now();var r=s.stopTimestamp-s.startTimestamp,a=Math.abs(s.stopX-s.startX),u=Math.abs(s.stopY-s.startY);if(r<=o.timespan&&a<=o.delta.x&&u<=o.delta.y)for(var l=0;l<s.callbacks.length;l++)i.try2Call(s.callbacks[l],e,t)},e.addEventListener("touchend",u.touchend,o.useCapture))}},removeTapListener:function(e,i,a){if(!t)return void(e.removeEventListener?e.removeEventListener("click",i):e.detachEvent("onclick",i));if(e.hasOwnProperty(n)){var o=r(e,n+".tap"),s=o.callbacks.indexOf(i);if(s!=-1&&(o.callbacks.splice(s,1),0==o.callbacks.length)){var u=r(e,n+".tap.meta");e.removeEventListener("touchstart",u.touchstart),e.removeEventListener("touchend",u.touchend,a),delete e[n].tap}}}}}();e.View.touch=n}(window),function(e,t){var i=e.View.util,n=function(){var e={};i.defineReadOnlyProperty(this,"has",function(t){return t in e}),i.defineReadOnlyProperty(this,"set",function(t,i){return e[t]=i,this}),i.defineReadOnlyProperty(this,"get",function(t){return e[t]}),i.defineReadOnlyProperty(this,"remove",function(t){var i=e[t];return delete e[t],i}),i.defineReadOnlyProperty(this,"clear",function(){for(var t in e)delete e[t];return this}),i.defineReadOnlyProperty(this,"listKeys",function(){return Object.keys(e)}),i.defineReadOnlyProperty(this,"size",function(){var t=0;for(var i in e)t++;return t})};e.View.ViewContext=n}(window),function(e,t){var i=e.View.Logger.globalLogger,n={},r=function(e,t,r){var a,o=e,s=n;this.getName=function(){return o},this.getValue=function(e){if(n===s){if(arguments.length<1)return;return e}return s},this.setValue=function(e,t){return arguments.length<2&&(t=!1),(t||n===s)&&(s=e),this},this.getApplication=function(){return a},this.setApplication=function(e){return"function"!=typeof e?(i.warn("Application action should be of type: 'Function'"),this):(a=e,this)},this.apply=function(){if("function"==typeof a){var o=n===s?void 0:s;try{a.call(this,o)}catch(n){i.error("Fail to apply configuration: {} = {} for view of id: '{}' namespace: '{}'\n{}",e,String(o),t,r,n),n instanceof Error?console.error(n,n.stack):console.error(n)}}return this},this.reflectToDom=function(){return null==t||""===t.trim()?this:View.ifExists(t,r)?"function"==typeof this.getValue()||Array.isArray(this.getValue)?(i.warn("Invalid value to reflect to dom:"),console.warn(this.getValue()),this):(View.ofId(t,r).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())),this):(i.warn("No view of id '{}' in namespace: '{}' found to reflect config: {}={}",t,r,this.getName(),this.getValue()),this)},Object.freeze(this)};e.View.ViewConfiguration=r}(window),function(e,t){var i=e.View.util,n=e.View.ViewConfiguration,r=function(e,t){var r={};this.has=function(e){return e in r},this.get=function(i){var a;return i in r?a=r[i]:(a=new n(i,e,t),r[i]=a),a},this.applyAll=function(){var e=Object.keys(r).map(function(e){return r[e]});return 0===e.length?this:(setTimeout(function(){for(var t=0;t<e.length;t++){var n=e[t];i.try2Call(n.apply,n)}},0),this)},this.listAll=function(){return Object.keys(r)}};e.View.ViewConfigurationSet=r}(window),function(e,t){var i=e.View.util,n=e.View.Logger.globalLogger,r=i.randomString("ViewState_"),a=[],o=-1,s=function(e,t,n){var r=i.isEmptyString(t,!0)||"default"===t?"":"@"+String(t),a=String(e)+r,o=null==n?[]:Object.keys(n),s=o.reduce(function(e,t){return e+"&"+i.xEncodeURIComponent(t)+"="+i.xEncodeURIComponent(n[t])},"");return s.length>0&&(a+="!"+s.substring(1)),a},u=function(e,t,n,a){arguments.length<3&&(a=null),arguments.length<2&&(n=i.getUniqueString()),n=n||i.getUniqueString(),i.defineReadOnlyProperty(this,"viewId",e),i.defineReadOnlyProperty(this,"viewNamespace",t),i.defineReadOnlyProperty(this,"sn",n),i.defineReadOnlyProperty(this,"options",a),i.defineReadOnlyProperty(this,"flag",r),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};u.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("viewId")&&e.hasOwnProperty("sn")&&String(e.flag).startsWith("ViewState_"))},u.pushViewState=function(e,t,r,c){arguments.length<4&&(c=null),arguments.length<3&&(r=i.getUniqueString()),(arguments.length<2||i.isEmptyString(t,!0))&&(t="default"),r=r||i.getUniqueString();var f=new u(e,t,r,c).clone();n.log("↓ {}",JSON.stringify(f)),i.env.isHistoryPushPopSupported?history.pushState(f,"","#"+s(e,t,c)):location.hash=s(e,t,c),a.splice(o+1,a.length),a.push(f),o++,l(),View.currentState=f},u.replaceViewState=function(e,t,r,c){arguments.length<4&&(c=null),arguments.length<3&&(r=i.getUniqueString()),(arguments.length<2||i.isEmptyString(t,!0))&&(t="default"),r=r||i.getUniqueString();var f=new u(e,t,r,c).clone();if(n.log("% {}",JSON.stringify(f)),i.env.isHistoryPushPopSupported?history.replaceState(f,"","#"+s(e,t,c)):location.hash=s(e,t,c),0===a.length)a.push(f),o++;else{var g=a[o-1],d=a[o+1];null!=g&&g.sn===r?o--:null!=d&&d.sn===r?o++:a[o]=f,l()}View.currentState=f},u.getStackSize=function(){return a.length},u.ifCanGoBack=function(){return o>0};var l=function(){n.debug("View state stack: {}, {}",a.map(function(e){return e.sn}),o)};e.View.ViewState=u}(window),function(e,t){var i=(e.View.util,e.View.layout),n=e.View.Logger.globalLogger,r=document.documentElement,a=function(){},o={},s=-1,u=-1,l=0,c=0,f=function(e,t){var o=a,f=!0,g=50;this.setLayoutAction=function(e){return"function"!=typeof e?(n.error("Layout action should be of type: 'Function'"),this):(o!==e&&(o=e),this)},this.getLayoutAction=function(){return o},this.doLayout=function(){return"function"!=typeof o?this:((Math.abs(l-s)>0||Math.abs(c-u)>0)&&(r.offsetWidth,r.offsetHeight),o(),s=l,u=c,this)},this.setLayoutCushionTime=function(e){return null==e||isNaN(e=Number(e))||e<0?(n.error("Invalid layout cushion time. Should be a digit greater than or equal to 0"),this):(g=e,this)},this.getLayoutCushionTime=function(){return g},this.setIfLayoutWhenLayoutChanges=function(e){return f=!!e,this};var d,w=this;i.addLayoutChangeListener(function(i,r){f&&View.ofId(e,t).isActive()&&(n.debug("Layout changes, doing layout for view of id: '{}' namespace: '{}'. Width: {}, height: {}",e,t,i,r),l=i,c=r,clearTimeout(d),g>0?d=setTimeout(function(){w.doLayout()},g):w.doLayout())})};f.ofId=function(e,t){var i=e+"@"+t;if(i in o)return o[i];var n=new f(e,t);return o[i]=n,n},e.View.ViewLayout=f}(window),function(e,t){var i=e.View.util,n=function(){var e=i.randomString("OperationState_"),t=function(t,n){arguments.length<2&&(timeBasedUniqueString=i.getUniqueString()),timeBasedUniqueString=timeBasedUniqueString||i.getUniqueString(),i.defineReadOnlyProperty(this,"serialNumber",t),i.defineReadOnlyProperty(this,"sn",timeBasedUniqueString),i.defineReadOnlyProperty(this,"flag",e),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};t.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("serialNumber")&&e.hasOwnProperty("sn")&&String(e.flag).startsWith("OperationState_"))};var r=null,a={};return t.pushState=function(e,t){var i=new n(e).clone();history.pushState(i,"",""),r=i,a[e]=t},window.addEventListener("popstate",function(e){if(t.isConstructorOf(r)){var n=e.state&&e.state.sn&&e.state.sn<r.sn,o=a[r.serialNumber];n&&null!=o&&(i.try2Call(o),delete a[r.serialNumber])}var s=e.state;r=t.isConstructorOf(s)?s:null}),t}();e.View.OperationState=n}(window),function(e,t){var i=e.View.util,n=e.View.Logger,r=n.globalLogger,a={},o=function(e){var t=[],n={},a={},o=!1;this.getName=function(){return e},this.setSequence=function(e){return o?(r.error("Sequence is prohibited to change while executing"),this):Array.isArray(e)?(e=e.map(function(e){return null==e?"":String(e).trim().toLowerCase()}).reduce(function(e,t){return i.isEmptyString(t,!0)||e.indexOf(t)!==-1||e.push(t),e},[]),t=e,this):this},this.setProperty=function(e,t){return n[String[e]]=t,this},this.setProperties=function(e){if(null==e||"object"!=typeof e)return this;for(var t in e)this.setProperty(t,e[t]);return this},this.getProperty=function(e,t){return e=String(e),e in n?n[e]:arguments.length>1?t:null},this.setHandle=function(e,t){return o?(r.error("Handle is prohibited to change while executing"),this):(a[String(e).toLowerCase()]=t,this)},this.exec=function(){r.debug("Executing chained handle: {}",e),o=!0;var i,n,s=new Promise(function(e,t){i=e,n=t});if(s.then(function(){o=!1},function(){o=!1}),0===t.length)return i(),s;var u=function(e){if(e>=t.length)return void i();new Promise(function(i,n){var o=t[e],s=a[o];if(r.debug("Executing handle: {}",o),null==s)return void i();try{s(i,function(e){var t="Handle of name: "+o+"rejects";arguments.length>1?r.error(t,e):r.error(t),n(e)})}catch(e){r.error("Error occurred while executing handle of name: "+o),console.error(e),n(e)}}).then(function(){u(e+1)},n)};return u(0),s}};o.ofName=function(e){var t=a[e];return null==t&&(t=a[e]=new o(e)),t},e.View.ChainedHandle=o}(window),function(e,t){e.View.viewAttribute={attr$view:"data-view",attr$viewId:"data-view-id",attr$view_name:"data-view-name",attr$view_namespace:"data-view-namespace",attr$view_default:"data-view-default",attr$view_directly_accessible:"data-view-directly-accessible",attr$view_group:"data-view-group",attr$view_fallback:"data-view-fallback",attr$view_fallback_namespace:"data-view-fallback-namespace",attr$view_rel:"data-view-rel",attr$view_rel_namespace:"data-view-rel-namespace",attr$view_rel_type:"data-view-rel-type",attr$view_rel_disabled:"data-view-rel-disabled",attr$view_title:"data-view-title",attr$view_container:"data-view-container",attr$view_os:"data-view-os",attr$view_whr:"data-view-whr",attr$view_state:"data-view-state",attr$active_view_id:"data-active-view-id",attr$active_view_namespace:"data-active-view-namespace"}}(window),function(e,t){var i=(e.View.Logger.globalLogger,e.View.util),n=function(e){return":back"===e||":forward"===e||":default-view"===e},r=function(e){if(""===e)return null;var t=e.match(/^#([\w$\-]+)(?:@([^!]+))?(?:!+(.*))?/);if(null==t)return null;var n=t[1],r=t[2],a=i.parseParams(t[3]);return i.isEmptyString(r,!0)&&(r="default"),{viewId:n,viewNamespace:r,options:a}};e.View.viewRepresentation={PSVIEW_BACK:":back",PSVIEW_FORWARD:":forward",PSVIEW_DEFAULT:":default-view",isPseudoView:n,parseViewInfoFromHash:r}}(window),function(e,t){var i=(e.View.Logger.globalLogger,e.View.viewRepresentation),n={},r=function(e,t){return e+"@"+t in n},a=function(e,t){return n[e+"@"+t]},o=function(e,t,i){n[e+"@"+t]=i},s=function(e,t){delete n[e+"@"+t]},u=function(e,t,n){if(!View.ifExists(e,t)&&!i.isPseudoView(e))throw new Error("View of id: '"+e+"' within namespace: '"+t+"' does not exist");if(void 0===n&&(n=null),"object"!=typeof n)throw new Error("Parameters specified should be an object or null");return o(e,t,n),View},l=function(e,t){return delete n[e+"@"+t],View};e.View.viewParameter={hasParameters:r,getParameters:a,setParameters:o,removeParameters:s,setViewParameters:u,clearViewParameters:l}}(window),function(e,t){var i=e[t].Logger.globalLogger,n=e[t].util,r=e[t].ViewLayout,a=e[t].viewParameter,o=e[t].viewRepresentation,s=e[t].viewAttribute,u={},l=[],c=[],f=null,g=!1,d=function(e){e in u||(u[e]=[])},w=function(e){if(!(e instanceof HTMLElement))return null;var t=e.getAttribute(s.attr$viewId);return n.isEmptyString(t,!0)&&(t=e.id),t},h=function(){var e=document.querySelector("["+s.attr$view_container+"]");return null==e&&(e=document.body),e},p=function(e){if(!(e instanceof HTMLElement))return!1;var t=e.getAttribute(s.attr$view);return null!=t&&("true"===(t=t.toLowerCase())&&!n.isEmptyString(w(e),!0))},v=function(){var e,t=h(),i=[],r=document.querySelectorAll("*["+s.attr$view+"=true]");for(e=0;e<r.length;e++)p(r[e])&&i.push(r[e]);for(r=t.querySelectorAll("["+s.attr$viewId+"]"),e=0;e<r.length;e++){var a=w(r[e]);n.isEmptyString(a,!0)||i.indexOf(r[e])===-1&&(r[e].setAttribute(s.attr$view,"true"),i.push(r[e]))}return i},m=function(e,t){(arguments.length<2||n.isEmptyString(t,!0))&&(t="default"),d(t);var i=document.querySelectorAll("["+s.attr$view+"=true]");if(0===i.length)return null;for(var r=null,a=0;a<i.length;a++){var o=i[a],u=w(o),l=o.getAttribute(s.attr$view_namespace);if(n.isEmptyString(l,!0)&&(l="default"),e===u&&l===t){r=o;break}}return r},y=function(e,t){(arguments.length<2||"string"!=typeof t||n.isEmptyString(t,!0))&&(t="default"),d(t);var i=null;return n.isEmptyString(e,!0)||!View.ifExists(e,t)?i=View.getActiveView()||View.getDefaultView():(i=View.ofId(e,t),i.isDirectlyAccessible()||(i=i.getFallbackView())),i},V=function(e){arguments.length>1&&(e=String(e).trim().toLowerCase());var t=[];for(var i in u)t=t.concat(u[i]);return arguments.length<1||n.isEmptyString(e,!0)?t:t.filter(function(t){return e===t.getName()||e===t.getGroupName()})},S=function(e){if(n.isEmptyString(e,!0))return i.error("Empty view name!"),null;e=String(e).trim().toLowerCase();var t=V(e);if(null==t||0===t.length)return i.error("No view of name: {} found",e),null;var r=t[0];return i.info("Found {} views of name: {}: {}, using the first one: {}@{}",t.length,e,r.id,r.namespace),r},b=function(e){n.isEmptyString(e,!0)&&(e=View.SWITCHTYPE_VIEWNAV);var t=n.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWNAV),i=n.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWCHANGE),r=n.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYBACK),a=n.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYFORWARD);return r||a||t||i||(e=View.SWITCHTYPE_VIEWNAV),e},E=function(e){n.isEmptyString(e,!0)&&(e=View.SWITCHTRIGGER_APP);var t=n.ifStringEqualsIgnoreCase(e,View.SWITCHTRIGGER_APP),i=n.ifStringEqualsIgnoreCase(e,View.SWITCHTRIGGER_NAVIGATOR);return t||i||(e=View.SWITCHTRIGGER_APP),e},A=function(e){e=n.setDftValue(e,{srcView:null,targetView:null,type:View.SWITCHTYPE_VIEWNAV,trigger:View.SWITCHTRIGGER_APP,withAnimation:!0,params:null,options:null});var t=e.srcView,u=e.targetView,d=b(e.type),w=E(e.trigger),p=e.params,v=e.options,m=n.ifStringEqualsIgnoreCase(d,View.SWITCHTYPE_HISTORYBACK),y=n.ifStringEqualsIgnoreCase(d,View.SWITCHTYPE_HISTORYFORWARD),V={currentView:t,targetView:u,type:d,trigger:w,params:p,options:v},S=function(){var e=u.id,f=u.namespace;a.clearViewParameters(e,f),m?a.hasParameters(o.PSVIEW_BACK,"")&&(a.setViewParameters(e,f,a.getParameters(o.PSVIEW_BACK,"")),a.clearViewParameters(o.PSVIEW_BACK,"")):y?a.hasParameters(o.PSVIEW_FORWARD,"")&&(a.setViewParameters(e,f,a.getParameters(o.PSVIEW_FORWARD,"")),a.clearViewParameters(o.PSVIEW_FORWARD,"")):a.setViewParameters(e,f,p);var S={sourceView:t,type:d,trigger:w,params:p,options:v},b=function(e,t){try{u.fire(e,S,t)}catch(t){i.error("Error occurred while firing event: {} with data: {}",e,S),t instanceof Error?console.error(t,t.stack):console.error(t)}};t&&t.getDomElement().classList.remove("active"),t&&t.fire("leave",{targetView:u,type:d}),l.push(u),b("beforeenter",!1),u.getDomElement().classList.add("active"),n.blurInputs(),r.ofId(e,f).doLayout(),View.fire("change",V,!1),u.isReady()||(c.push(u),b("ready",!1)),b("enter",!1),b("afterenter",!1);var E=h();E.setAttribute(s.attr$active_view_id,e),E.setAttribute(s.attr$active_view_namespace,f),g=!1,View.fire("afterchange",V)};View.fire("beforechange",V,!1),e.withAnimation&&f?f.call(null,{srcElement:t?t.getDomElement():null,targetElement:u.getDomElement(),type:d,trigger:w,render:S}):S()},I=function(e,t,r){if((arguments.length<2||"string"!=typeof t||n.isEmptyString(t,!0))&&(t="default"),d(t),r=n.setDftValue(r,{},!0),!View.ifExists(e,t))throw i.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,r.params,r.options),new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist!");var a=View.getActiveView();i.log("{}@{} → {}@{} {}",a?a.getId():null,a?a.getNamespace():null,e,t,JSON.stringify(r));var o=View.ofId(e,t);return r.srcView=a,r.targetView=o,A(r),View};e[t].viewInternalVariable={defaultNamespace:"default",defaultWidthHeightRatio:"320/568",get isSwitchingByApp(){return g},set isSwitchingByApp(e){g=!!e},viewInstancesMap:u,readyViews:c,viewVisitStack:l,get viewSwitchAnimation(){return f},set viewSwitchAnimation(e){f=e},getPotentialViewId:w,getViewContainerDomElement:h,getViewDomElements:v,getViewDomElementOfId:m,buildNamespace:d,getFinalView:y,listAllViews:V,findFirstViewOfName:S,switchView:A,showView:I}}(window,"View"),function(e,t){var i=e[t].util,n=e[t].eventDrive,r=(e[t].ViewState,e[t].Logger),a=e[t].ViewConfigurationSet,o=e[t].ViewContext,s=e[t].ViewLayout,u=e[t].viewRepresentation,l=e[t].viewParameter,c=e[t].viewAttribute,f=e[t].viewInternalVariable,g=r.globalLogger,d=function(e,t){(arguments.length<2||i.isEmptyString(t,!0))&&(t=f.defaultNamespace);var w=null,h=document.querySelectorAll("["+c.attr$view+"=true]");if(0===h.length||function(){for(var n=0;n<h.length;n++){var r=h[n],a=f.getPotentialViewId(r),o=r.getAttribute(c.attr$view_namespace);if(i.isEmptyString(o,!0)&&(o=f.defaultNamespace),e===a&&o===t){w=r;break}}return null==w}())throw new Error("View of id: '"+e+"' within namespace: '"+t+"' does not exist!");var p={},v=new o,m=new a(e,t);n(this,w);var y=this.fire;this.fire=function(e,t,i){p[e]=t,y(e,t,i)};var V=this;i.defineReadOnlyProperty(this,"id",e),i.defineReadOnlyProperty(this,"namespace",t),i.defineReadOnlyProperty(this,"logger",r.ofName("View#"+e)),i.defineReadOnlyProperty(this,"config",m),i.defineReadOnlyProperty(this,"context",v),this.getLatestEventData=function(e){return p[e]},this.getContext=function(){return v},this.clearContext=function(){return v.clear(),this},this.getId=function(){return e},this.getNamespace=function(){return t},this.getDomElement=function(){return w},this.getName=function(){var e=w.getAttribute(c.attr$view_name);return null==e?e:e=String(e).trim().toLowerCase()},this.getGroupName=function(){g.warn("This method is deprecated, please use 'this.getName()' instead"),g.warn("Attribute 'data-view-group' is deprecated, please use 'data-view-name' instead");var e=w.getAttribute(c.attr$view_group);return null==e?e:e=String(e).trim().toLowerCase()},this.find=function(e){return w.querySelector(e)},this.findAll=function(e){return w.querySelectorAll(e)},this.setLayoutAction=function(i,n){return arguments.length<2&&(n=!0),s.ofId(e,t).setIfLayoutWhenLayoutChanges(!!n).setLayoutAction(i),this},this.getLayoutAction=function(){return s.ofId(e,t).getLayoutAction()},this.hasParameter=function(e){if(null===e||void 0===e)return!1;var t=l.getParameters(this.id,this.namespace);return null!=t&&e in t},this.getParameter=function(e){var t=l.getParameters(this.id,this.namespace);return arguments.length<1?t:null==t?null:t[e]},this.seekParameter=function(e){if(this.hasParameter(e))return this.getParameter(e);if(d.hasActiveViewOption(e))return d.getActiveViewOption(e);var t=new RegExp("\\b"+e+"\\b=([^&\\?]*)"),i=location.search.match(t);return null==i?null:i=decodeURIComponent(i[1])},this.isReady=function(){return f.readyViews.indexOf(this)!==-1},this.isActive=function(){return w.classList.contains("active")},this.getActiveTimes=function(){return f.viewVisitStack.reduce(function(e,t){return t===V&&e++,e},0)},this.isDefault=function(){return/true/i.test(w.getAttribute(c.attr$view_default))},this.isDirectlyAccessible=function(){var e=w.getAttribute(c.attr$view_directly_accessible);return e=null==e?null:e.toLowerCase(),d.isDirectlyAccessible()?"false"!==e:"true"===e},this.setAsDirectlyAccessible=function(e){return arguments.length<1&&(e=!0),w.setAttribute(c.attr$view_directly_accessible,String(e)),this},this.setTitle=function(e){return null==e?(w.removeAttribute(c.attr$view_title),this):(e=String(e),w.setAttribute(c.attr$view_title,e),this.isActive()&&(document.title=e),this)},this.getTitle=function(){return w.getAttribute(c.attr$view_title)},this.setFallbackViewId=function(e,t){if(i.isEmptyString(e,!0))return this;if((arguments.length<2||i.isEmptyString(t,!0))&&(t=f.defaultNamespace),f.buildNamespace(t),i.ifStringEqualsIgnoreCase(u.PSVIEW_DEFAULT,e)){var n=d.getDefaultView();if(null==n)return g.error("No default view found to set as fallback view"),this;e=n.id,t=n.namespace}else if(/^~/.test(e)){var r=e.substring(1),a=f.findFirstViewOfName(r);if(null==a)return g.warn("No view of name: {} found to set as fallback view",r),this;e=a.id,t=a.namespace}return d.ifExists(e,t)?this.id===e&&this.namespace===t?this:(w.setAttribute(c.attr$view_fallback,e),w.setAttribute(c.attr$view_fallback_namespace,t),
this):(g.warn("No view of id: {} in namespace: {} found to set as fallback view",e,t),this)},this.getFallbackView=function(){for(var e=this,t=[{id:this.id,namespace:this.namespace}];;){var n=e.getDomElement(),r=n.getAttribute(c.attr$view_fallback);if(null==r||""===(r=r.trim()))return d.getDefaultView();if(i.ifStringEqualsIgnoreCase(u.PSVIEW_DEFAULT,r))return d.getDefaultView();var a=n.getAttribute(c.attr$view_fallback_namespace)||f.defaultNamespace;if(/^~/.test(r)){var o=r.substring(1),s=f.findFirstViewOfName(o);if(null==s)return g.warn("No view of name: {} found to render as fallback view for view: {} in namespace: {}",this.id,this.namespace),d.getDefaultView();r=s.id,a=s.namespace}if(!d.ifExists(r,a))return g.debug("Configured fallback view of id: {}, namespace: {} doest not exist for view: {} in namespace: {}",r,a,this.getId(),this.getNamespace()),d.getDefaultView();if(e=d.ofId(r,a),t.some(function(e){return e.id===r&&e.namespace===a}))return g.error("Cyclical reference on fallback view configuration. Chain: {}",t),d.getDefaultView();if(e.isDirectlyAccessible())return e;t.push({id:r,namespace:a})}}};n(d),i.defineReadOnlyProperty(d,"SWITCHTYPE_HISTORYFORWARD","history.forward"),i.defineReadOnlyProperty(d,"SWITCHTYPE_HISTORYBACK","history.back"),i.defineReadOnlyProperty(d,"SWITCHTYPE_VIEWNAV","view.nav"),i.defineReadOnlyProperty(d,"SWITCHTYPE_VIEWCHANGE","view.change"),i.defineReadOnlyProperty(d,"SWITCHTRIGGER_APP","app"),i.defineReadOnlyProperty(d,"SWITCHTRIGGER_NAVIGATOR","navigator"),e[t].ViewConstructor=d}(window,"View"),function(e,t){var i=e[t].util,n=e[t].Logger,r=e[t].touch,a=e[t].layout,o=e[t].ViewConstructor,s=e[t].ViewContext,u=e[t].ViewState,l=e[t].OperationState,c=(e[t].ViewLayout,e[t].ChainedHandle),f=e[t].viewRepresentation,g=e[t].viewParameter,d=e[t].viewAttribute,w=e[t].viewInternalVariable,h=n.globalLogger;o.currentState=null,o.Logger=n,o.layout=a,o.context=new s,o.checkIfBrowserHistorySupportsPushPopAction=function(){return i.env.isHistoryPushPopSupported},o.getViewContainerDomElement=w.getViewContainerDomElement,o.find=function(e,t){return 1===arguments.length&&(t=arguments[0],e=o.getViewContainerDomElement()),e.querySelector(t)},o.findAll=function(e,t){return 1===arguments.length&&(t=arguments[0],e=o.getViewContainerDomElement()),e.querySelectorAll(t)},o.ofId=function(e,t){(arguments.length<2||i.isEmptyString(t,!0))&&(t=w.defaultNamespace),w.buildNamespace(t);for(var n=w.viewInstancesMap[t],r=0;r<n.length;r++)if(n[r].getId().trim()===e.trim()&&n[r].getNamespace().trim()===t.trim())return n[r];var a=new o(e,t);return n.push(a),a},o.ifExists=function(e,t){(arguments.length<2||i.isEmptyString(t,!0))&&(t=w.defaultNamespace),w.buildNamespace(t);for(var n=w.viewInstancesMap[t],r=0;r<n.length;r++)if(n[r].getId().trim()===e.trim())return!0;return!1},o.listAll=w.listAllViews,o.listAllViewNames=function(){return w.listAllViews().reduce(function(e,t){var n=t.getName();return i.isEmptyString(n,!0)||e.indexOf(n)!==-1?e:(e.push(n.toLowerCase().trim()),e)},[])},o.listAllGroups=function(){return h.warn("This method is deprecated, please use 'View.listAllViewNames()' instead"),o.listAllViewNames()},o.setAsDefault=function(e,t){if((arguments.length<2||i.isEmptyString(t,!0))&&(t=w.defaultNamespace),w.buildNamespace(t),i.isEmptyString(e,!0))return h.warn("No view id supplied to set as default"),o;for(var n=w.getViewDomElements(),r=0;r<n.length;r++)n[r].removeAttribute(d.attr$view_default);var a=w.getViewDomElementOfId(e,t);return null==a?(h.error("No dom element for view of id: '{}' namespace: '{}' found to set as default",e,t),o):(a.setAttribute(d.attr$view_default,"true"),o)},o.isDirectlyAccessible=function(){var e,t=d.attr$view_directly_accessible,n=o.getViewContainerDomElement().getAttribute(t),r=document.documentElement.getAttribute(t);if(null===n){if(null===r)return!1;e=r,h.warn("Declaring view attribute: '{}' in <html> element is deprecated, you should declare in the view container's dom element",t)}else null===r?e=n:(e=n,h.warn("Found view attribute: '{}' in the view container's dom element, ingoring the one declared in <html> element",t));return i.ifStringEqualsIgnoreCase("true",e)},o.setIsDirectlyAccessible=function(e){return document.documentElement.setAttribute(d.attr$view_directly_accessible,String(!!e).toLowerCase()),o},o.setViewIsDirectlyAccessible=function(e,t,i){if(arguments.length<2)throw new Error("Illegal argument length. Call with arguments: 'viewId[, viewNamespace], accessible'");arguments.length<3&&(i=arguments[1],t=w.defaultNamespace);var n=w.getViewDomElementOfId(e,t);return null==n?(h.error("No view of id: {}, namespace: {} found to set is directly accessible or not",e,t),o):(n.setAttribute(d.attr$view_directly_accessible,String(!!i).toLowerCase()),o)},o.getActiveView=function(){for(var e=w.listAllViews(),t=0;t<e.length;t++)if(e[t].isActive())return e[t];return null},o.getDefaultView=function(){for(var e=w.listAllViews(),t=0;t<e.length;t++)if(e[t].isDefault())return e[t];return null},o.setSwitchAnimation=function(e){if(!(e instanceof Function))throw new Error("Invalid argument, type of 'Function' is required");return w.viewSwitchAnimation=e,o},o.getSwitchAnimation=function(){return w.viewSwitchAnimation},o.getActiveViewOptions=function(){var e=f.parseViewInfoFromHash(location.hash);return null==e?null:e.options},o.hasActiveViewOption=function(e){var t=o.getActiveViewOptions();return null!=t&&e in t},o.getActiveViewOption=function(e){var t=o.getActiveViewOptions();return null==t?null:t[e]},o.setActiveViewOption=function(e,t){if(i.isEmptyString(e,!0))return h.error("Option name should not be empty"),o;var n=o.getActiveView();if(null==n)return h.error("No view is active to set option {} = {}",e,t),o;e=String(e).trim(),t=String(t).trim();var r=o.getActiveViewOptions()||{};return r[e]=t,u.replaceViewState(n.getId(),n.getNamespace(),o.currentState?o.currentState.sn:null,r),o},o.passBy=function(e,t){if((arguments.length<2||"string"!=typeof t||i.isEmptyString(t,!0))&&(t=w.defaultNamespace),w.buildNamespace(t),i.ifStringEqualsIgnoreCase(f.PSVIEW_DEFAULT,e)){var n=o.getDefaultView();if(null==n)return h.error("No default view found"),o;e=n.id,t=n.namespace}if(/^~/.test(e)){var r=e.substring(1),a=w.findFirstViewOfName(r);if(null==a)return o;e=a.id,t=a.namespace}return o.ifExists(e,t)?(u.pushViewState(e,t),o):(console.error(new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist!")),o)},o.getChainedHandleByName=function(e){return c.ofName(e)},o.navTo=function(e,t,n){(arguments.length<2||"string"!=typeof t||i.isEmptyString(t,!0))&&(n=t,t=w.defaultNamespace),w.buildNamespace(t),e=e.trim(),n=i.setDftValue(n,{});o.getActiveView();if(i.ifStringEqualsIgnoreCase(f.PSVIEW_BACK,e))return o.back(n),o;if(i.ifStringEqualsIgnoreCase(f.PSVIEW_FORWARD,e))return o.forward(n),o;if(i.ifStringEqualsIgnoreCase(f.PSVIEW_DEFAULT,e)){var r=o.getDefaultView();if(null==r)return h.error("No default view found"),o;e=r.id,t=r.namespace}if(/^\s*~/.test(e)){var a=e.replace(/^\s*~+/,"").trim(),s=w.findFirstViewOfName(a);if(null==s)return o;e=s.id,t=s.namespace}if(/^(http|https|ftp):\/\//gim.test(e))return window.location.assign(e),o;if(/^\s*@+/.test(e)){var l=e.replace(/^\s*@+/,"").trim();return""===l?void h.warn("Empty target: '{}'",e):(window.location.assign(l),o)}if(!o.ifExists(e,t)){h.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options);var c=new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist! Firing event 'viewnotexist'...");return console.error(c),o.fire("viewnotexist",{targetViewId:e,targetViewNamespace:t}),o}return n.type=o.SWITCHTYPE_VIEWNAV,n.trigger=o.SWITCHTRIGGER_APP,u.pushViewState(e,t,null,null==n?null:n.options),w.showView(e,t,n),o},o.changeTo=function(e,t,n){(arguments.length<2||"string"!=typeof t||i.isEmptyString(t,!0))&&(n=t,t=w.defaultNamespace),w.buildNamespace(t),n=i.setDftValue(n,{});o.getActiveView();if(i.ifStringEqualsIgnoreCase(f.PSVIEW_DEFAULT,e)){var r=o.getDefaultView();if(null==r)return void h.error("No default view found");e=r.id,t=r.namespace}if(/^\s*~/.test(e)){var a=e.replace(/^\s*~+/,"").trim(),s=w.findFirstViewOfName(a);if(null==s)return o;e=s.id,t=s.namespace}if(/^(http|https|ftp):\/\//gim.test(e))return window.location.replace(e),o;if(/^\s*@+/.test(e)){var l=e.replace(/^\s*@+/,"").trim();return""===l?void h.warn("Empty target: '{}'",e):(window.location.replace(l),o)}if(!o.ifExists(e,t)){h.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options);var c=new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist! Firing event 'viewnotexist'...");return console.error(c),o.fire("viewnotexist",{targetViewId:e,targetViewNamespace:t}),o}return n.type=o.SWITCHTYPE_VIEWCHANGE,n.trigger=o.SWITCHTRIGGER_APP,u.replaceViewState(e,t,null,null==n?null:n.options),w.showView(e,t,n),o};var p=null;o.setNoViewToNavBackAction=function(e){if("function"!=typeof e)throw new Error("Invalid argument! Type of 'Function' is required");return p=e,o},o.back=function(e){return w.isSwitchingByApp=!0,g.clearViewParameters(f.PSVIEW_BACK,""),null!=e&&"params"in e&&g.setViewParameters(f.PSVIEW_BACK,"",e.params),o.ifCanGoBack()||"function"!=typeof p?history.go(-1):i.try2Call(p),o},o.forward=function(e){return w.isSwitchingByApp=!0,g.clearViewParameters(f.PSVIEW_FORWARD,""),null!=e&&"params"in e&&g.setViewParameters(f.PSVIEW_FORWARD,"",e.params),history.go(1),o};var v=document.title;o.setDocumentTitle=function(e){return i.isEmptyString(e,!0)?(h.warn("Invalid document title: "+e),o):(document.title=v=e,o)},o.onceHistoryBack=function(e){if("function"!=typeof e)throw new Error("Invalid argument! Type of 'Function' is required");return l.pushState(i.randomString(),e),o},o.reDoLayout=function(){return w.listAllViews().forEach(function(e){i.try2Call(e.getLayoutAction())}),o},o.ifCanGoBack=u.ifCanGoBack;var m,y,V,S,b,E=!1,A=!1,I=function(e){var t=o.getActiveView(),n=null==t?null:t.getId(),r=null==t?null:t.getNamespace();h.log("{} Current: {}",i.env.isHistoryPushPopSupported?"State popped!":"Hash changed!",t&&t.getId()),h.log("↑ {}",i.env.isHistoryPushPopSupported?JSON.stringify(e.state):location.hash);var a,s,l,c=o.SWITCHTYPE_VIEWNAV,g=null;if(null==e.state){c=o.SWITCHTYPE_VIEWNAV;var d,p,v=f.parseViewInfoFromHash(location.hash);if(null==v?(g=t,d=n,p=r):(a=v.viewId,s=v.viewNamespace,null!=(g=w.getFinalView(a,s))&&(d=g.getId(),p=g.getNamespace())),null!=d){var m=d==a&&p==s;l=d==n&&p==r?o.currentState?o.currentState.options:null:m?v.options:null,u.replaceViewState(d,p,null,l),w.showView(g.getId(),g.getNamespace(),{type:c,options:l})}}else if(u.isConstructorOf(e.state)){var y=e.state;a=y.viewId,s=y.viewNamespace,o.ifExists(a,s)?(g=o.ofId(a,s),l=y.options):(h.warn("Popped view: '"+a+"' within namespace: '"+s+"' does not exist, keeping current"),g=t,l=null);var d=g.getId(),p=g.getNamespace();null!=o.currentState&&(c=y.sn<o.currentState.sn?o.SWITCHTYPE_HISTORYBACK:o.SWITCHTYPE_HISTORYFORWARD),u.replaceViewState(d,p,y.sn,l),w.showView(d,p,{type:c,trigger:w.isSwitchingByApp?o.SWITCHTRIGGER_APP:o.SWITCHTRIGGER_NAVIGATOR,options:l})}else h.info("Skip state: {}",e.state)},P=function(){m(),v=document.title,document.documentElement.setAttribute(d.attr$view_os,i.env.isIOS?"ios":i.env.isAndroid?"android":i.env.isWindowsPhone?"wp":"unknown"),window.addEventListener(i.env.isHistoryPushPopSupported?"popstate":"hashchange",I),function(){var e=document.querySelectorAll("["+d.attr$view_container+"]");if(0===e.length)document.body.setAttribute(d.attr$view_container,"");else for(var t=1;t<e.length;t++)e[t].removeAttribute(d.attr$view_container)}(),o.getViewContainerDomElement().setAttribute(d.attr$view_state,"initing");var e=w.getViewDomElements(),t=[];[].forEach.call(e,function(e){var n=e.getAttribute(d.attr$view_namespace);i.isEmptyString(n,!0)&&(n=w.defaultNamespace,e.setAttribute(d.attr$view_namespace,n));var r=w.getPotentialViewId(e),a=o.ofId(r,n);if(t.indexOf(a)!==-1)return void h.warn("Multiple view of id: '{}' within namespace: '{}' exists",a.id,a.namespace);t.push(a),e.classList.remove("active"),e.classList.add("view"),a.on("enter",function(){var t=e.getAttribute(d.attr$view_title);document.title=null==t?v:t})});var n=null;n=function(){for(var t=null,i=-1,n=0;n<e.length;n++)if("true"===e[n].getAttribute(d.attr$view_default)){i=n;break}if(-1!==i){t=e[i];for(var n=i+1;n<e.length;n++)"true"===e[n].getAttribute(d.attr$view_default)&&e[n].removeAttribute(d.attr$view_default)}else 0!==e.length?(t=e[0],t.setAttribute(d.attr$view_default,"true")):h.warn("No view exists to serve as default view");return t}(),null!=n&&n.classList.add("active"),r.addTapListener(document.documentElement,function(e){for(var t,n=e.changedTouches?e.changedTouches[0].target:e.target,r=w.defaultNamespace,a=n;null==a.getAttribute(d.attr$view_rel)&&(a=a.parentNode,a instanceof HTMLElement||(a=null),null!=a););if(null!=a&&(t=a.getAttribute(d.attr$view_rel),r=a.getAttribute(d.attr$view_rel_namespace)),i.isEmptyString(r,!0)&&(r=w.defaultNamespace),null!=t&&""!==t.trim()){if(!("true"===a.getAttribute(d.attr$view_rel_disabled))){if(e.preventDefault(),/^(http|https|ftp):\/\//gim.test(t))return void(window.location.href=t);if(/^\s*@+/.test(t)){var s=t.replace(/^\s*@+/,"").trim();return""===s?void h.warn("Empty file path for data-view-rel: '{}'",t):void(window.location.href=s)}if(i.ifStringEqualsIgnoreCase(f.PSVIEW_BACK,t))return void o.back();if(i.ifStringEqualsIgnoreCase(f.PSVIEW_FORWARD,t))return void o.forward();if(i.ifStringEqualsIgnoreCase(f.PSVIEW_DEFAULT,t)){var u=o.getDefaultView();null!=u&&(t=u.id,r=u.namespace)}var l=null;if(/^~/.test(t)){var c=t.match(/^~([^!]+)(?:!+(.*))?/);if(null==c)return;var g=c[1].trim(),p=i.parseParams(c[2]),v=w.findFirstViewOfName(g);if(null==v)return;t=v.id,r=v.namespace,l=p}else{var m=f.parseViewInfoFromHash("#"+t);t=m.viewId,r=m.viewNamespace||w.defaultNamespace,l=m.options}var y=a.getAttribute(d.attr$view_rel_type);y=i.isEmptyString(y,!0)?"nav":y,/^(?:nav)|(?:change)$/.test(y)||(h.warn("Unknown view switch type: {}. {}",y,a),y="nav"),o[y+"To"](t,r,{options:l})}}},{useCapture:!0}),function(){i.blurInputs();var e=o.getViewContainerDomElement().getAttribute(d.attr$view_whr);if(null!=e&&""!==(e=e.trim().toLowerCase())||null!=(e=document.documentElement.getAttribute(d.attr$view_whr))&&""!==(e=e.trim().toLowerCase())&&h.warn("Declaring view attribute: '{}' in <html> element is deprecated, you should declare in the view container's dom element",d.attr$view_whr),null==e||""===(e=e.trim().toLowerCase()))return void a.init().doLayout(!1);if("unlimited"!==e){var t=/(\d+(?:\.\d*)?)\s*\/\s*(\d+(?:\.\d*)?)/i,n=e.match(t);null==n?(h.warn("Invalid view expected width height ratio: {}. Value such as '320/568'(iPhone 5) is valid. Using '{}' instead",e,w.defaultWidthHeightRatio),n=w.defaultWidthHeightRatio.exec(t)):h.info("Using specified expected width height ratio: {}",e),a.setExpectedWidthHeightRatio(Number(n[1])/Number(n[2])).init(),a.doLayout(!1)}}(),h.info("Marking View as initialized and ready"),y(),V(),function(){if(null!=o.currentState)return void h.debug("Skip showing specified view");var e=null==n?null:w.getPotentialViewId(n),t=null==n?null:n.getAttribute(d.attr$view_namespace)||w.defaultNamespace,r=f.parseViewInfoFromHash(location.hash),a=null==r?null:r.viewId,s=null==r?null:r.viewNamespace,l=null==r?null:r.options,c=null,g=null,p=i.isEmptyString(e,!0);if(!i.isEmptyString(a,!0)&&o.ifExists(a,s)?(c=a,g=s):(h.warn("No view of id: '{}' namespace: '{}'(specified in the location hash) found, trying to show the default view",a,s),!p&&o.ifExists(e,t)?(c=e,g=t):(h.warn("No default view of id: '{}' within namespace: '{}' found",e,t),c=null,g=null)),i.isEmptyString(c,!0))return void h.warn("Can not determine the initial view!");var v=w.getFinalView(c,g);if(null==v)return void h.error("No final view found for view of id: '{}', namespace: '{}'",c,g);c=v.getId(),g=v.getNamespace(),c==a&&g==s||(l=null),h.info("Showing view: '{}' within namespace: '{}'",c,g),u.replaceViewState(c,g,null,l);var m=o.getActiveView();w.switchView({srcView:m==v?null:m,targetView:v,withAnimation:!1,params:null})}()};o.beforeInit=function(){var e=[];return m=function(){for(var t=0;t<e.length;t++)i.try2Call(e[t]);e=[]},y=function(){E=!0},function(t){return E?o:(e.indexOf(t)===-1&&e.push(t),o)}}(),o.ready=function(){var e=[];return V=function(){A=!0;for(var t=0;t<e.length;t++)i.try2Call(e[t]);e=[],o.getViewContainerDomElement().setAttribute(d.attr$view_state,"ready")},function(t){return A?(i.try2Call(t),o):(e.indexOf(t)===-1&&e.push(t),o)}}(),o.setInitializer=function(e,t){if("function"==typeof e){arguments.length<2&&(t="domready");var i="domready, rightnow".split(/\s*,\s*/);i.indexOf(t)===-1&&(h.warn("Unknown initializer exec time: {}. Supported: {}",t,i),t="domready"),S=e,b=t,E||"rightnow"!==t||(h.info("Calling specified view initializer right now"),e(P))}},document.addEventListener("DOMContentLoaded",function(){null==S?(h.info("Initializing View automatically on dom ready"),P()):"domready"===b&&(h.info("Calling specified view initializer on dom ready"),S(P))}),e[t]=o}(window,"View");