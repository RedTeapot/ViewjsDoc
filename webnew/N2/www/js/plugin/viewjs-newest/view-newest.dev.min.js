/**
 * This version is built for test only, we do not recommend you use it in production environment.

 * View.js vnewest.dev
 * author: Billy, wmjhappy_ok@126.com
 * license: MIT
 * 
 * -- 2020-05-05 13:50
 */
(function(t){var n;if(n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t in n)console.error("Plugin name: 'View' has already been used");else{function e(e){n[t]=e}var i={},r={has:function(e){return e in i},set:function(e,t){if(e in i)throw new Error("Internal error: Key: '"+e+"' has already been used");i[e]=t},get:function(e){return i[e]},expose:e};e(function(e){if("function"==typeof e)try{e(r)}catch(e){console.error(e)}})}})("View"),View(function(e){function i(){if(0!==arguments.length){var i=arguments,e=" "+String(arguments[0]),r=1;return(e=(e=e.replace(/([^\\])\{\}/g,function(e,t){var n=i.length-1<r?"{}":String(s(i[r]));return r++,t+n})).replace(/\\\{\}/g,"{}")).substring(1)}}function r(e){return function(){var e=new Date,t=(e.getFullYear(),"0"+String(e.getMonth()+1));t=t.substring(t.length-2);var n="0"+String(e.getDate());n=n.substring(n.length-2);var i="0"+String(e.getHours());i=i.substring(i.length-2);var r="0"+String(e.getMinutes());r=r.substring(r.length-2);var a="0"+String(e.getSeconds());return t+n+" "+i+":"+r+":"+(a=a.substring(a.length-2))}()+" ["+e+"]: "}function n(t){var n=!0;this.isEnabled=function(){return o&&n},this.setIsEnabled=function(e){return n=e,this},this.getName=function(){return t},this.debug=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.debug(r(t)+e)}},this.info=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.info(r(t)+e)}},this.warn=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.warn(r(t)+e)}},this.error=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.error(r(t)+e)}},this.log=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.log(r(t)+e)}}}var a={},o=!0,s=function(e){if(null==e)return null;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e)return e;if("function"==typeof e)return"function "+e.name+"(){...}";if("object"!=typeof e||Array.isArray(e))return e instanceof Array?"["+e.map(function(e){return s(e)}).join(", ")+"]":e;if("[object Object]"!==String(e))return String(e);var t=JSON.stringify(e);if("{}"!==t)return t;try{var n={};for(var i in e)n[i]=s(e[i]);return JSON.stringify(n)}catch(e){return t}};n.ofName=function(e){if(e in a)return a[e];var t=new n(e);return a[e]=t},n.isGloballyEnabled=function(){return o},n.setIsGloballyEnabled=function(e){o=!!e},n.globalLogger=n.ofName("View"),e.set("Logger",n)}),View(function(e){function l(e,t){this.type=e,this.timestamp=(new Date).getTime(),this.data=t,Object.freeze&&Object.freeze(this)}e.set("eventDrive",function(e,a){function o(e){s[e]=s[e]||[]}var s={};e.on=function(e,t){String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){o(e),-1===s[e].indexOf(t)&&s[e].push(t)})},e.off=function(e,n){String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){o(e);var t=s[e].indexOf(n);-1!==t&&s[e].splice(t,1)})},e.fire=function(e,t,r){arguments.length<3&&(r=!0),String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(n){function e(){o(n);for(var e=0;e<s[n].length;e++){var t=s[n][e];if("function"==typeof t)try{t.call(a,i)}catch(e){console.error(e,e.stack)}}}var i=new l(n,t);r?setTimeout(e,0):e()})}})}),View(function(toolbox){var globalLogger=toolbox.get("Logger").globalLogger,setDftValue=function(e,t,n){for(var i in arguments.length<3&&(n=!1),e=e||{},t=t||{})i in e&&!(i in e&&null==e[i]&&n)||(e[i]=t[i]);return e},defineReadOnlyProperty=function(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!1,writable:!1,enumerable:!0})},try2Apply=function(t,e,n){if(null!=t&&"function"==typeof t)try{t.apply(e,n)}catch(e){var i=e instanceof Error||null!=e&&"object"==typeof e&&"stack"in e,r="Error occured while executing function: {}. {}"+(i?" stack:\n{}":"");globalLogger.error(r,t.name,e,i?e.stack:null)}},try2Call=function(func,ctx,args){if(null!=func&&"function"==typeof func)try{var len=arguments.length;if(1===len)return func();if(2===len)return func.call(ctx);if(3===len)return func.call(ctx,args);if(4===len)return func.call(ctx,args,arguments[3]);if(5===len)return func.call(ctx,args,arguments[3],arguments[4]);if(6===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5]);if(7===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5],arguments[6]);for(var tmp="",index=2,i=index,rst;i<arguments.length;i++)tmp+=",arguments["+i+"]";return eval("rst = func.call(ctx"+tmp+")"),rst}catch(e){return console.error("Error occurred while executing function: "+func.name,e.stack||e),void console.error(func)}},isEmptyString=function(e,t){return arguments.length<2&&(t=!1),null==e||(e=String(e),t&&(e=e.trim()),0===e.length)},isNullOrUndefined=function(e){return null==e},ifStringEquals=function(e,t,n,i){return arguments.length<4&&(i=!0),arguments.length<3&&(n=!0),isNullOrUndefined(e)?!!isNullOrUndefined(t):!isNullOrUndefined(t)&&(i&&(e=String(e).trim(),t=String(t).trim()),n||(e=e.toLowerCase(),t=t.toLowerCase()),e===t)},ifStringEqualsIgnoreCase=function(e,t,n){return arguments.length<3&&(n=!0),ifStringEquals(e,t,!1,n)},randomString=(_a="0123456789abcdefghijklmnopqrstuvwxyz",function(e){arguments.length<1&&(e="");for(var t=10,n="";0<t--;){var i=Math.floor(Math.random()*_a.length);n+=_a.charAt(i)}return e+n}),_a,xEncodeURIComponent=function(e){return encodeURIComponent(String(e)).replace(/\+/gm,"%2B")},getUniqueString=(fb=0,function(){var e=Date.now().toString(36),t="00"+(fb++).toString(36);return(e+(t=t.substring(t.length-2))).toUpperCase()}),fb,getComputedStyle=function(e){return window.getComputedStyle?window.getComputedStyle(e):e.currentStyle},env=(kb=navigator.userAgent,lb={},(lb.refresh=mb)(),lb),kb,lb;function mb(){return kb=navigator.userAgent,lb.isUC=/(?:UCWEB|UCBrowser)/.test(kb),lb.isSafari=/(?:Safari)/.test(kb),lb.isOpera=/(?:Opera Mini)/.test(kb),lb.isTencent=/(?:MQQBrowser|QQ|MicroMessenger)/.test(kb),lb.isTencentMiniProgram=lb.isTencent&&(/(?:miniprogram)/i.test(kb)||"miniprogram"===window.__wxjs_environment),lb.isIOS=/(?:Mac OS)/.test(kb),lb.isAndroid=/(?:Android)/.test(kb),lb.isWindowsPhone=/(?:Windows Phone)/.test(kb),lb.isIPad=lb.isIOS&&/(?:iPad)/.test(kb),lb.isIPhone=lb.isIOS&&/(?:iPhone)/.test(kb),lb.isTablet=/(?:Tablet|PlayBook)/.test(kb)||lb.isIPad,lb.isMobile=/(?:Mobile)/.test(kb)&&!lb.isIPad||lb.isWindowsPhone,lb.isPc=!lb.isMobile&&!lb.isTablet,lb.isHistoryPushPopSupported="pushState"in history&&"function"==typeof history.pushState,lb}var parseParams=function(e){if(isEmptyString(e,!0))return null;var n=null,t=e.split(/\s*&\s*/);return 0!==t.length&&(n={},t.forEach(function(e){var t=e.split(/\s*=\s*/);n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})),n},blurInputs=function(){for(var e=document.querySelectorAll("input, select, textarea, *[contentEditable]"),t=0;t<e.length;t++)e[t].blur()},hasClass=function(e,t){return!isEmptyString(t,!0)&&(e.classList&&e.classList.contains?e.classList.contains(t):new RegExp("\\b"+t+"\\b","gim").test(e.className))},addClass=function(e,t){isEmptyString(t,!0)||hasClass(e,t)||(e.classList&&e.classList.add?e.classList.add(t):e.className=(e.className.trim()+" "+t).trim())},removeClass=function(e,t){if(!isEmptyString(t,!0)&&hasClass(e,t))if(e.classList&&e.classList.remove)e.classList.remove(t);else{t=String(t).toLowerCase();for(var n=e.className.split(/\s+/),i="",r=0;r<n.length;r++){var a=n[r];isEmptyString(a,!0)||a.toLowerCase()!==t&&(i+=" "+a)}0<i.length&&(i=i.substring(1)),e.className=i.trim()}},toggleClass=function(e,t){return hasClass(e,t)?(removeClass(e,t),!1):(addClass(e,t),!0)},startsWith=function(e,t){if(null==t)return!1;var n=(t=String(t)).length;return!(this.length<n)&&e.substring(0,n)===t},isPromiseSupported=function(){return"undefined"!=typeof Promise&&null!=Promise&&"function"==typeof Promise.resolve},applyInternally=function(e,t,n){return e.apply(t,n)},callInternally=function(func,ctx,args){var len=arguments.length;if(1===len)return func();if(2===len)return func.call(ctx);if(3===len)return func.call(ctx,args);if(4===len)return func.call(ctx,args,arguments[3]);if(5===len)return func.call(ctx,args,arguments[3],arguments[4]);if(6===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5]);if(7===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5],arguments[6]);for(var tmp="",index=2,i=index,rst;i<arguments.length;i++)tmp+=",arguments["+i+"]";return eval("rst = func.call(ctx"+tmp+")"),rst},markAsInternalCallableOnly=function(t){return function(){var e=arguments.callee.caller;if(e!==callInternally&&e!==applyInternally)throw new Error("Illegal function call, only internal valid caller is permitted");return t.apply(this,arguments)}};toolbox.set("util",{setDftValue:setDftValue,defineReadOnlyProperty:defineReadOnlyProperty,try2Apply:try2Apply,try2Call:try2Call,isEmptyString:isEmptyString,isNullOrUndefined:isNullOrUndefined,startsWith:startsWith,ifStringEquals:ifStringEquals,ifStringEqualsIgnoreCase:ifStringEqualsIgnoreCase,randomString:randomString,xEncodeURIComponent:xEncodeURIComponent,getUniqueString:getUniqueString,getComputedStyle:getComputedStyle,parseParams:parseParams,blurInputs:blurInputs,isPromiseSupported:isPromiseSupported,hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,callInternally:callInternally,applyInternally:applyInternally,markAsInternalCallableOnly:markAsInternalCallableOnly,env:env})}),View(function(e){function t(){var e=u.clientWidth,t=u.clientHeight,n=window.innerWidth||e,i=window.innerHeight||t;s.env.refresh();var r=s.env.isPc,a=!1,o=[];r!==d&&(a=!0,o.push("env")),.5<Math.abs(n-c)?(a=!0,o.push("width"),o.push("width"+(g<e?"+":"-"))):.5<Math.abs(i-f)&&(a=!0,o.push("height"),o.push("height"+(f<i?"+":"-"))),g=e,c=n,f=i,d=r,a&&(l.debug("Resolution changes. Changed aspects: {}",o),function(e){for(var t=0;t<h.length;t++){var n=h[t],i=n.listeningChangeAspects;if(Array.isArray(i)){for(var r=!1,a=0;a<i.length;a++)if(-1!==e.indexOf(i[a])){r=!0;break}r&&s.try2Call(n,null,e)}else s.try2Call(n,null,e)}}(o))}var s=e.get("util"),l=e.get("Logger").globalLogger,u=document.documentElement,c=0,f=0,g=0,d=null,h=[];t(),setInterval(t,20);var n={addChangeListener:function(e,t){1===arguments.length&&"function"==typeof e&&(t=e,e=null),-1===h.indexOf(t)&&(Array.isArray(e)&&(e=e.map(function(e){return String(e).trim().toLowerCase()})),t.listeningChangeAspects=e,h.push(t))}};e.set("resolution",n)}),View(function(e){function h(){return a.querySelector("[data-view-container]")||document.body}function w(){var e=h(),t=E.getComputedStyle(e),n=Number(t.paddingLeft.replace(/px/,"")),i=Number(t.paddingRight.replace(/px/,""));return isNaN(n)&&(n=0),isNaN(i)&&(i=0),e.clientWidth-n-i}function p(){var e=h(),t=E.getComputedStyle(e),n=Number(t.paddingTop.replace(/px/,"")),i=Number(t.paddingBottom.replace(/px/,""));return isNaN(n)&&(n=0),isNaN(i)&&(i=0),e.clientHeight-n-i}function m(){return window.innerWidth||a.clientWidth}function v(){return window.innerHeight||a.clientHeight}function t(){return w()<=p()}function y(){return m()<=v()}function b(){return!y()}var S,V,n=e.get("Logger").globalLogger,E=e.get("util"),i=e.get("resolution"),A=320/568,I=[],r=!1,C={},a=document.documentElement,P=function(e,t){var n=this.style;n.width=e+"px",n.height=t+"px"},T=P,_=P,N=T,L=P,O=T,x=O,o=(S=w(),V=p(),function(e){var t,n,i,r,a,o,s,l;arguments.length<1&&(e=!0),E.env.isPc?(s=m(),l=v(),y()?E.try2Call(L,h(),s,l):x===O?(s=l*A,E.try2Call(P,h(),s,l)):E.try2Call(x,h(),s,l)):E.env.isTablet?(r=m(),a=v(),o=b()?N:_,E.try2Call(o,h(),r,a)):(t=m(),n=v(),i=b()?T:P,E.try2Call(i,h(),t,n));var u=w(),c=p(),f=m(),g=v();if(.1<=Math.abs(S-u)||.1<=Math.abs(V-c)){function d(){for(var e=0;e<I.length;e++){var t=I[e];"function"==typeof t&&E.try2Call(t,null,u,c,f,g)}}e?setTimeout(d,0):d()}return C});(0,E.setDftValue)(C,{getLayoutWidth:w,getLayoutHeight:p,getBrowserWidth:m,getBrowserHeight:v,isLayoutPortrait:t,isLayoutLandscape:function(){return!t()},isBrowserPortrait:y,isBrowserLandscape:b,getLayoutWidthHeightRatio:function(){return m()/v()},getBrowserWidthHeightRatio:function(){return m()/v()},getExpectedWidthHeightRatio:function(){return A},setExpectedWidthHeightRatio:function(e){return A=e,C},init:function(e){return r?n.warn("Layout was initialized already"):(r=!0,e=E.setDftValue(e,{autoReLayoutWhenResize:!0,layoutAsMobilePortrait:P,layoutAsMobileLandscape:T,layoutAsTabletLandscape:N,layoutAsTabletPortrait:_,layoutAsPcPortrait:L,layoutAsPcLandscape:x}),!!e.autoReLayoutWhenResize&&i.addChangeListener(function(e){-1!==e.indexOf("height-")||-1!==e.indexOf("height+")&&p()>=v()||o(!1)}),"function"==typeof e.layoutAsMobilePortrait&&(P=e.layoutAsMobilePortrait),"function"==typeof e.layoutAsMobileLandscape&&(T=e.layoutAsMobileLandscape),"function"==typeof e.layoutAsTabletPortrait&&(_=e.layoutAsTabletPortrait),"function"==typeof e.layoutAsTabletLandscape&&(N=e.layoutAsTabletLandscape),"function"==typeof e.layoutAsPcPortrait&&(L=e.layoutAsPcPortrait),"function"==typeof e.layoutAsPcLandscape&&(x=e.layoutAsPcLandscape)),C},doLayout:o,addLayoutChangeListener:function(e){if(-1===I.indexOf(e))return I.push(e),C},removeLayoutChangeListener:function(e){var t=I.indexOf(e);if(-1!==t)return I.splice(t,1),C}}),Object.freeze&&Object.freeze(C),e.set("layout",C)}),View(function(e){function u(e,t){return(e=e||{})[t]=e[t]||{},e[t]}var c=e.get("util"),f=(window,/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent)),g="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ";e.set("touch",{addTapListener:function(o,e,s){if(f){var l=u(o,g+".tap");if(l.callbacks=l.callbacks||[],-1===l.callbacks.indexOf(e)){l.callbacks.push(e),(s=c.setDftValue(s,{timespan:500,delta:{},useCapture:!1})).delta=c.setDftValue(s.delta,{x:10,y:15});var t=u(o,g+".tap.meta");null==t.touchstart&&(t.touchstart=function(e){var t=e.changedTouches?e.changedTouches[0]:e;l.startX=t.screenX,l.startY=t.screenY,l.startTimestamp=Date.now()},o.addEventListener("touchstart",t.touchstart)),null==t.touchend&&(t.touchend=function(e){var t=e.changedTouches?e.changedTouches[0]:e;l.stopX=t.screenX,l.stopY=t.screenY,l.stopTimestamp=Date.now();var n=l.stopTimestamp-l.startTimestamp,i=Math.abs(l.stopX-l.startX),r=Math.abs(l.stopY-l.startY);if(n<=s.timespan&&i<=s.delta.x&&r<=s.delta.y)for(var a=0;a<l.callbacks.length;a++)c.try2Call(l.callbacks[a],o,e)},o.addEventListener("touchend",t.touchend,s.useCapture))}}else o.addEventListener?o.addEventListener("click",e):o.attachEvent("onclick",e)},removeTapListener:function(e,t,n){if(f){if(e.hasOwnProperty(g)){var i=u(e,g+".tap"),r=i.callbacks.indexOf(t);if(-1!==r&&(i.callbacks.splice(r,1),0===i.callbacks.length)){var a=u(e,g+".tap.meta");e.removeEventListener("touchstart",a.touchstart),e.removeEventListener("touchend",a.touchend,n),delete e[g].tap}}}else e.removeEventListener?e.removeEventListener("click",t):e.detachEvent("onclick",t)}})}),View(function(e){e.get("util");e.set("ViewContext",function(){var n={};this.has=function(e){return e in n},this.set=function(e,t){return n[e]=t,this},this.get=function(e){return n[e]},this.remove=function(e){var t=n[e];return delete n[e],t},this.clear=function(){for(var e in n)delete n[e];return this},this.listKeys=function(){return Object.keys(n)},this.size=function(){var e=0;for(var t in n)e++;return e}})}),View(function(e){var s=e.get("Logger").globalLogger,l={};e.set("ViewConfiguration",function(n,i,r){var a,e=n,o=l;this.getName=function(){return e},this.getValue=function(e){return l!==o?o:arguments.length<1?void 0:e},this.setValue=function(e,t){return arguments.length<2&&(t=!1),!t&&l!==o||(o=e),this},this.getApplication=function(){return a},this.setApplication=function(e){return"function"!=typeof e?s.warn("Application action should be of type: 'Function'"):a=e,this},this.apply=function(){if("function"==typeof a){var t=l===o?void 0:o;try{a.call(this,t)}catch(e){s.error("Fail to apply configuration: {} = {} for view of id: '{}' namespace: '{}'\n{}",n,String(t),i,r,e),e instanceof Error?console.error(e,e.stack):console.error(e)}}return this},this.reflectToDom=function(){return null==i||""===i.trim()||(View.ifExists(i,r)?"function"==typeof this.getValue()||Array.isArray(this.getValue)?(s.warn("Invalid value to reflect to dom:"),console.warn(this.getValue())):View.ofId(i,r).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())):s.warn("No view of id '{}' in namespace: '{}' found to reflect config: {}={}",i,r,this.getName(),this.getValue())),this},Object.freeze(this)})}),View(function(e){var a=e.get("util"),o=e.get("ViewConfiguration");e.set("ViewConfigurationSet",function(n,i){var r={};this.has=function(e){return e in r},this.get=function(e){var t;return e in r?t=r[e]:(t=new o(e,n,i),r[e]=t),t},this.applyAll=function(){var n=Object.keys(r).map(function(e){return r[e]});return 0===n.length||setTimeout(function(){for(var e=0;e<n.length;e++){var t=n[e];a.try2Call(t.apply,t)}},0),this},this.listAll=function(){return Object.keys(r)}})}),View(function(e){function s(e,t,n){var i=u.isEmptyString(t,!0)||f===t?"":"@"+String(t),r=String(e)+i,a=(null==n?[]:Object.keys(n)).reduce(function(e,t){return e+"&"+u.xEncodeURIComponent(t)+"="+u.xEncodeURIComponent(n[t])},"");return 0<a.length&&(r+="!"+a.substring(1)),r}function l(e,t,n,i){arguments.length<3&&(i=null),arguments.length<2&&(n=u.getUniqueString()),n=n||u.getUniqueString(),u.defineReadOnlyProperty(this,"viewId",e),u.defineReadOnlyProperty(this,"viewNamespace",t),u.defineReadOnlyProperty(this,"sn",n),u.defineReadOnlyProperty(this,"options",i),u.defineReadOnlyProperty(this,"flag",r),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return{viewId:e,viewNamespace:t,sn:n,options:i,flag:r}}}var u=e.get("util"),c=e.get("Logger").globalLogger,f="default",t="ViewState_",r=u.randomString(t),g=[],d=-1;l.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("viewId")&&e.hasOwnProperty("sn")&&u.startsWith(e.flag,t))},l.pushViewState=function(e,t,n,i){arguments.length<4&&(i=null),arguments.length<3&&(n=u.getUniqueString()),(arguments.length<2||u.isEmptyString(t,!0))&&(t=f),n=n||u.getUniqueString();var r=new l(e,t,n,i).clone();c.log("↓ {}",JSON.stringify(r)),u.env.isHistoryPushPopSupported?history.pushState(r,"","#"+s(e,t,i)):location.hash=s(e,t,i),g.splice(d+1,g.length),g.push(r),d++,h(),View.currentState=r},l.replaceViewState=function(e,t,n,i){arguments.length<4&&(i=null),arguments.length<3&&(n=u.getUniqueString()),(arguments.length<2||u.isEmptyString(t,!0))&&(t=f),n=n||u.getUniqueString();var r=new l(e,t,n,i).clone();if(c.log("% {}",JSON.stringify(r)),u.env.isHistoryPushPopSupported?history.replaceState(r,"","#"+s(e,t,i)):location.hash=s(e,t,i),0===g.length)g.push(r),d++;else{var a=g[d-1],o=g[d+1];null!=a&&a.sn===n?d--:null!=o&&o.sn===n?d++:g[d]=r,h()}View.currentState=r},l.getStackSize=function(){return g.length},l.ifCanGoBack=function(){return 0<d};var h=function(){c.debug("View state stack: {}, {}",g.map(function(e){return e.sn}),d)};e.set("ViewState",l)}),View(function(e){e.get("util");function l(){}function r(n,i){var t=l,r=!0,a=50;this.setLayoutAction=function(e){return"function"!=typeof e?c.error("Layout action should be of type: 'Function'"):t!==e&&(t=e),this},this.getLayoutAction=function(){return t},this.doLayout=function(){return"function"!=typeof t||((0<Math.abs(h-g)||0<Math.abs(w-d))&&(f.offsetWidth,f.offsetHeight),t(),g=h,d=w),this},this.setLayoutCushionTime=function(e){return null==e||isNaN(e=Number(e))||e<0?c.error("Invalid layout cushion time. Should be a digit greater than or equal to 0"):a=e,this},this.getLayoutCushionTime=function(){return a},this.setIfLayoutWhenLayoutChanges=function(e){return r=!!e,this};var o,s=this;u.addLayoutChangeListener(function(e,t){r&&View.ofId(n,i).isActive()&&(c.debug("Layout changes, doing layout for view of id: '{}' namespace: '{}'. Width: {}, height: {}",n,i,e,t),h=e,w=t,clearTimeout(o),0<a?o=setTimeout(function(){s.doLayout()},a):s.doLayout())})}var u=e.get("layout"),c=e.get("Logger").globalLogger,f=document.documentElement,a={},g=-1,d=-1,h=0,w=0;r.ofId=function(e,t){var n=e+"@"+t;if(n in a)return a[n];var i=new r(e,t);return a[n]=i},e.set("ViewLayout",r)}),View(function(e){function r(e,t){arguments.length<2&&(t=a.getUniqueString()),t=t||a.getUniqueString(),a.defineReadOnlyProperty(this,"serialNumber",e),a.defineReadOnlyProperty(this,"sn",t),a.defineReadOnlyProperty(this,"flag",n),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}}var a=e.get("util"),t="OperationState_",n=a.randomString(t),o=null,s={};r.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("serialNumber")&&e.hasOwnProperty("sn")&&a.startsWith(e.flag,t))},r.pushState=function(e,t){var n=new OperationState(e).clone();history.pushState(n,"",""),o=n,s[e]=t},window.addEventListener("popstate",function(e){if(r.isConstructorOf(o)){var t=e.state&&e.state.sn&&e.state.sn<o.sn,n=s[o.serialNumber];t&&null!=n&&(a.try2Call(n),delete s[o.serialNumber])}var i=e.state;o=r.isConstructorOf(i)?i:null}),e.set("OperationState",r)}),View(function(e){function n(r){var a=[],n={},o={},s=!1;this.getName=function(){return r},this.setSequence=function(e){return s?l.error("Sequence is prohibited to change while executing"):Array.isArray(e)&&(e=e.map(function(e){return null==e?"":String(e).trim().toLowerCase()}).reduce(function(e,t){return i.isEmptyString(t,!0)||-1!==e.indexOf(t)||e.push(t),e},[]),a=e),this},this.setProperty=function(e,t){return n[String[e]]=t,this},this.setProperties=function(e){if(null==e||"object"!=typeof e)return this;for(var t in e)this.setProperty(t,e[t]);return this},this.getProperty=function(e,t){return(e=String(e))in n?n[e]:1<arguments.length?t:null},this.setHandle=function(e,t){return s?l.error("Handle is prohibited to change while executing"):o[String(e).toLowerCase()]=t,this},this.exec=function(){var n,i;l.debug("Executing chained handle: {}",r),s=!0;var e=new Promise(function(e,t){n=e,i=t});if(e.then(function(){s=!1},function(){s=!1}),0===a.length)return n(),e;var t=function(r){r>=a.length?n():new Promise(function(e,n){var i=a[r],t=o[i];if(l.debug("Executing handle: {}",i),null!=t)try{t(e,function(e){var t="Handle of name: "+i+"rejects";1<arguments.length?l.error(t,e):l.error(t),n(e)})}catch(e){l.error("Error occurred while executing handle of name: "+i),console.error(e),n(e)}else e()}).then(function(){t(r+1)},i)};return t(0),e}}var i=e.get("util"),l=e.get("Logger").globalLogger,r={};n.ofName=function(e){var t=r[e];return null==t&&(t=r[e]=new n(e)),t},e.set("ChainedHandle",n)}),View(function(e){e.set("viewAttribute",{attr$viewId:"data-view-id",attr$view_name:"data-view-name",attr$view_group:"data-view-group",attr$view_namespace:"data-view-namespace",attr$view_title:"data-view-title",attr$view_fallback:"data-view-fallback",attr$view_fallback_namespace:"data-view-fallback-namespace",attr$view:"data-view",attr$view_default:"data-view-default",attr$view_directly_accessible:"data-view-directly-accessible",attr$view_whr:"data-view-whr",attr$view_state:"data-view-state",attr$view_os:"data-view-os",attr$active_view_id:"data-active-view-id",attr$active_view_namespace:"data-active-view-namespace",attr$view_container:"data-view-container",attr$view_rel:"data-view-rel",attr$view_rel_namespace:"data-view-rel-namespace",attr$view_rel_type:"data-view-rel-type",attr$view_rel_disabled:"data-view-rel-disabled"})}),View(function(e){e.get("Logger").globalLogger;var a=e.get("util"),t=":forward",n=":default-view",o=/^#([\w$\-]+)(?:@([^!]+))?(?:!+(.*))?/;e.set("viewRepresentation",{PSVIEW_BACK:":back",PSVIEW_FORWARD:t,PSVIEW_DEFAULT:n,isPseudoView:function(e){return":back"===e||t===e||n===e},parseViewInfoFromHash:function(e){if(""===e)return null;var t=e.match(o);if(null==t)return null;var n=t[1],i=t[2],r=a.parseParams(t[3]);return a.isEmptyString(i,!0)&&(i="default"),{viewId:n,viewNamespace:i,specifiedViewNamespace:t[2],options:r}}})}),View(function(e){function i(e,t,n){a[e+"@"+t]=n}var t=e.get("util"),r=(e.get("Logger").globalLogger,e.get("viewRepresentation")),n=t.randomString("_autosavedparams_"),a={};e.set("viewParameter",{keyForParamsAutoSavedToContext:n,hasParameters:function(e,t){return e+"@"+t in a},getParameters:function(e,t){return a[e+"@"+t]},setParameters:i,removeParameters:function(e,t){delete a[e+"@"+t]},setViewParameters:function(e,t,n){if(!View.ifExists(e,t)&&!r.isPseudoView(e))throw new Error("View of id: '"+e+"' within namespace: '"+t+"' does not exist");if(void 0===n&&(n=null),"object"!=typeof n)throw new Error("Parameters specified should be an object or null");return i(e,t,n),View},clearViewParameters:function(e,t){return delete a[e+"@"+t],View}})}),View(function(e){function l(e){e in r||(r[e]=[])}function u(e){if(!(e instanceof HTMLElement))return null;var t=e.getAttribute(V.attr$viewId);return v.isEmptyString(t,!0)&&(t=e.id),t}function m(){var e=document.querySelector("["+V.attr$view_container+"]");return null==e&&(e=document.body),e}function a(e){if(e instanceof HTMLElement){var t=e.getAttribute(V.attr$view);return null!=t&&("true"===(t=t.toLowerCase())&&!v.isEmptyString(u(e),!0))}}function i(t){1<arguments.length&&(t=String(t).trim().toLowerCase());var e=[];for(var n in r)e=e.concat(r[n]);return arguments.length<1||v.isEmptyString(t,!0)?e:e.filter(function(e){return t===e.getName()})}function o(e){var l=(e=v.setDftValue(e,{srcView:null,targetView:null,type:View.SWITCHTYPE_VIEWNAV,trigger:View.SWITCHTRIGGER_APP,withAnimation:!0,params:null,options:null,onbeforeswitch:null})).srcView,u=e.targetView,c=function(e){v.isEmptyString(e,!0)&&(e=View.SWITCHTYPE_VIEWNAV);var t=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWNAV),n=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWCHANGE),i=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYBACK),r=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYFORWARD);return i||r||t||n||(e=View.SWITCHTYPE_VIEWNAV),e}(e.type),f=function(e){v.isEmptyString(e,!0)&&(e=View.SWITCHTRIGGER_APP);var t=v.ifStringEqualsIgnoreCase(e,View.SWITCHTRIGGER_APP),n=v.ifStringEqualsIgnoreCase(e,View.SWITCHTRIGGER_NAVIGATOR);return t||n||(e=View.SWITCHTRIGGER_APP),e}(e.trigger),g=e.params,d=e.options,h=v.ifStringEqualsIgnoreCase(c,View.SWITCHTYPE_HISTORYBACK),w=v.ifStringEqualsIgnoreCase(c,View.SWITCHTYPE_HISTORYFORWARD),p={get currentView(){return s.warn("Field 'currentView' is deprecated, please use 'sourceView' instead"),l},sourceView:l,targetView:u,type:c,trigger:f,params:g,options:d};Object.freeze&&Object.freeze(p);for(var t=View.getSwitchInterceptors(),n=0;n<t.length;n++){var i=t[n];try{if(!i(p))return s.info("Supplied switch interceptor(name: {}) blocked the view switch",i.name),void console.log(i)}catch(e){return console.error("Error occurred while executing supplied interceptor",i),void console.error(e)}}function r(){var e=u.id,t=u.namespace;b.clearViewParameters(e,t);var n=b.keyForParamsAutoSavedToContext,i=u.getIfAutoSaveParamsToContext();if(h){if(b.hasParameters(S.PSVIEW_BACK,"")){var r=b.getParameters(S.PSVIEW_BACK,"");b.setViewParameters(e,t,r),b.clearViewParameters(S.PSVIEW_BACK,""),i?null!=r&&"object"==typeof r&&u.context.set(n,r):u.context.remove(n)}}else if(w){if(b.hasParameters(S.PSVIEW_FORWARD,"")){r=b.getParameters(S.PSVIEW_FORWARD,"");b.setViewParameters(e,t,b.getParameters(S.PSVIEW_FORWARD,"")),b.clearViewParameters(S.PSVIEW_FORWARD,""),i?null!=r&&"object"==typeof r&&u.context.set(n,r):u.context.remove(n)}}else b.setViewParameters(e,t,g),i?null!=g&&"object"==typeof g&&u.context.set(n,g):u.context.remove(n);function a(e,t){u.fire(e,o,t)}var o={sourceView:l,type:c,trigger:f,params:g,options:d};l&&v.removeClass(l.getDomElement(),"active"),l&&l.fire("leave",{targetView:u,type:c,trigger:f,params:g,options:d}),E.push(u),a("beforeenter",!1),v.addClass(u.getDomElement(),"active"),v.blurInputs(),y.ofId(e,t).doLayout(),View.fire("change",p,!1),u.isReady()||(A.push(u),a("ready",!1)),a("enter",!1),a("afterenter",!1);var s=m();s.setAttribute(V.attr$active_view_id,e),s.setAttribute(V.attr$active_view_namespace,t),C=null,View.fire("afterchange",p)}v.try2Call(e.onbeforeswitch),View.fire("beforechange",p,!1),e.withAnimation&&I?I.call(null,{srcElement:l?l.getDomElement():null,targetElement:u.getDomElement(),type:c,trigger:f,render:r}):r()}var s=e.get("Logger").globalLogger,v=e.get("util"),y=e.get("ViewLayout"),b=e.get("viewParameter"),S=e.get("viewRepresentation"),V=e.get("viewAttribute"),r={},E=[],A=[],I=null,c="default",C=null;e.set("viewInternalVariable",{defaultNamespace:c,defaultWidthHeightRatio:"320/568",get intendedSwitchType(){return C},set intendedSwitchType(e){C=e},viewInstancesMap:r,readyViews:A,viewVisitStack:E,get viewSwitchAnimation(){return I},set viewSwitchAnimation(e){I=e},getPotentialViewId:u,getViewContainerDomElement:m,getViewDomElements:function(){var e,t=m(),n=[],i=document.querySelectorAll("*["+V.attr$view+"=true]");for(e=0;e<i.length;e++)a(i[e])&&n.push(i[e]);for(i=t.querySelectorAll("["+V.attr$viewId+"]"),e=0;e<i.length;e++){var r=u(i[e]);v.isEmptyString(r,!0)||-1===n.indexOf(i[e])&&(i[e].setAttribute(V.attr$view,"true"),n.push(i[e]))}return n},getViewDomElementOfId:function(e,t){(arguments.length<2||v.isEmptyString(t,!0))&&(t=c),l(t);var n=document.querySelectorAll("["+V.attr$view+"=true]");if(0===n.length)return null;for(var i=null,r=0;r<n.length;r++){var a=n[r],o=u(a),s=a.getAttribute(V.attr$view_namespace);if(v.isEmptyString(s,!0)&&(s=c),e===o&&s===t){i=a;break}}return i},buildNamespace:l,getFinalView:function(e,t){(arguments.length<2||"string"!=typeof t||v.isEmptyString(t,!0))&&(t=c),l(t);var n=null;return v.isEmptyString(e,!0)||!View.ifExists(e,t)?n=View.getActiveView()||View.getDefaultView():(n=View.ofId(e,t)).isDirectlyAccessible()||(n=n.getFallbackView()),n},listAllViews:i,findFirstViewOfName:function(e){if(v.isEmptyString(e,!0))return s.error("Empty view name!"),null;e=String(e).trim().toLowerCase();var t=i(e);if(null==t||0===t.length)return s.error("No view of name: {} found",e),null;var n=t[0];return s.info("Found {} views of name: {}, using the first one: {}@{}",t.length,e,n.id,n.namespace),n},switchView:o,showView:function(e,t,n){if((arguments.length<2||"string"!=typeof t||v.isEmptyString(t,!0))&&(t=c),l(t),n=n||{},!View.ifExists(e,t))throw s.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options),new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist!");var i=View.getActiveView();s.log("{}@{} → {}@{} {}",i?i.getId():null,i?i.getNamespace():null,e,t,JSON.stringify(n));var r=View.ofId(e,t);return n.srcView=i,n.targetView=r,o(n),View}})}),View(function(e){var h=e.get("util"),w=e.get("eventDrive"),p=(e.get("ViewState"),e.get("Logger")),m=e.get("ViewConfigurationSet"),v=e.get("ViewContext"),y=e.get("ViewLayout"),b=e.get("viewRepresentation"),S=e.get("viewParameter"),V=e.get("viewAttribute"),E=e.get("viewInternalVariable"),A=p.globalLogger,I=function(r,a){(arguments.length<2||h.isEmptyString(a,!0))&&(a=E.defaultNamespace);for(var o=null,s=document.querySelectorAll("["+V.attr$view+"=true]"),e=[],t=0;t<s.length;t++)e.push(s[t]);s=document.querySelectorAll("["+V.attr$viewId+"]:not(["+V.attr$view+"=true])");for(t=0;t<s.length;t++)e.push(s[t]);if(0===(s=e).length||function(){for(var e=0;e<s.length;e++){var t=s[e],n=E.getPotentialViewId(t),i=t.getAttribute(V.attr$view_namespace);if(h.isEmptyString(i,!0)&&(i=E.defaultNamespace),r===n&&i===a){o=t;break}}return null==o}())throw new Error("View of id: '"+r+"' within namespace: '"+a+"' does not exist!");var i={},l=new v,n=new m(r,a),u=!0,c=null,f=[];w(this,o);var g=this.fire;this.fire=function(e,t,n){i[e]=t,g(e,t,n)};var d=this;h.defineReadOnlyProperty(this,"id",r),h.defineReadOnlyProperty(this,"namespace",a),h.defineReadOnlyProperty(this,"logger",p.ofName("View#"+r)),h.defineReadOnlyProperty(this,"config",n),h.defineReadOnlyProperty(this,"context",l),this.getLatestEventData=function(e){return i[e]},this.getContext=function(){return l},this.clearContext=function(){return l.clear(),this},this.getId=function(){return r},this.getNamespace=function(){return a},this.getDomElement=function(){return o},this.getName=function(){var e=o.getAttribute(V.attr$view_name);return null!=e?e=e.trim().toLowerCase():null==(e=o.getAttribute(V.attr$view_group))?null:(A.warn("Attribute 'data-view-group' is deprecated, please use 'data-view-name' instead"),e=e.trim().toLowerCase())},this.getGroupName=function(){A.warn("This method is deprecated, please use 'this.getName()' instead");var e=o.getAttribute(V.attr$view_group);return null==e?e:(A.warn("Attribute 'data-view-group' is deprecated, please use 'data-view-name' instead"),e=e.trim().toLowerCase())},this.find=function(e){return o.querySelector(e)},this.findAll=function(e){return o.querySelectorAll(e)},this.setLayoutAction=function(e,t){return arguments.length<2&&(t=!0),y.ofId(r,a).setIfLayoutWhenLayoutChanges(!!t).setLayoutAction(e),this},this.getLayoutAction=function(){return y.ofId(r,a).getLayoutAction()},this.hasParameter=function(e){if(null==e)return!1;var t=S.getParameters(this.id,this.namespace);return null!=t&&e in t},this.getParameter=function(e){var t=S.getParameters(this.id,this.namespace);return arguments.length<1?t||null:null==t?null:t[e]},this.seekParameter=function(e,t){if(this.hasParameter(e))return this.getParameter(e);if(I.hasActiveViewOption(e))return I.getActiveViewOption(e);var n=new RegExp("\\b"+e+"\\b=([^&\\?]*)"),i=location.search.match(n);if(null!=i)return decodeURIComponent(i[1]);if(arguments.length<2&&(t=!0),!t||!u)return null;var r=S.keyForParamsAutoSavedToContext,a=null;return l.has(r)&&null!=(a=l.get(r))&&"object"==typeof a&&e in a?a[e]:null},this.setIfAutoSaveParamsToContext=function(e){return arguments.length<1&&(e=!0),u=!!e,this},this.getIfAutoSaveParamsToContext=function(){return u},this.isReady=function(){return-1!==E.readyViews.indexOf(this)},this.isActive=function(){return h.hasClass(o,"active")},this.getActiveTimes=function(){return E.viewVisitStack.reduce(function(e,t){return t===d&&e++,e},0)},this.isDefault=function(){return/true/i.test(o.getAttribute(V.attr$view_default))},this.isDirectlyAccessible=function(){var e=o.getAttribute(V.attr$view_directly_accessible);return e=null==e?null:e.toLowerCase(),I.isDirectlyAccessible()?"false"!==e:"true"===e},this.setAsDirectlyAccessible=function(e){return arguments.length<1&&(e=!0),o.setAttribute(V.attr$view_directly_accessible,String(e)),this},this.setTitle=function(e){return null==e?o.removeAttribute(V.attr$view_title):(e=String(e),o.setAttribute(V.attr$view_title,e),this.isActive()&&(document.title=e)),this},this.getTitle=function(){return o.getAttribute(V.attr$view_title)},this.setFallbackViewId=function(e,t){if(h.isEmptyString(e,!0))return this;if((arguments.length<2||h.isEmptyString(t,!0))&&(t=E.defaultNamespace),E.buildNamespace(t),h.ifStringEqualsIgnoreCase(b.PSVIEW_DEFAULT,e)){var n=I.getDefaultView();if(null==n)return A.error("No default view found to set as fallback view"),this;e=n.id,t=n.namespace}else if(/^~/.test(e)){var i=e.substring(1),r=E.findFirstViewOfName(i);if(null==r)return A.warn("No view of name: {} found to set as fallback view",i),this;e=r.id,t=r.namespace}return I.ifExists(e,t)?this.id===e&&this.namespace===t||(o.setAttribute(V.attr$view_fallback,e),o.setAttribute(V.attr$view_fallback_namespace,t)):A.warn("No view of id: {} in namespace: {} found to set as fallback view",e,t),this},this.getFallbackView=function(){for(var e=this,t=[{id:this.id,namespace:this.namespace}];;){var n=e.getDomElement(),i=n.getAttribute(V.attr$view_fallback);if(null==i||""===(i=i.trim()))return I.getDefaultView();if(h.ifStringEqualsIgnoreCase(b.PSVIEW_DEFAULT,i))return I.getDefaultView();var r=n.getAttribute(V.attr$view_fallback_namespace)||E.defaultNamespace;if(/^~/.test(i)){var a=i.substring(1),o=E.findFirstViewOfName(a);if(null==o)return A.warn("No view of name: {} found to render as fallback view for view: {} in namespace: {}",this.id,this.namespace),I.getDefaultView();i=o.id,r=o.namespace}if(!I.ifExists(i,r))return A.debug("Configured fallback view of id: {}, namespace: {} doest not exist for view: {} in namespace: {}",i,r,this.getId(),this.getNamespace()),I.getDefaultView();if(e=I.ofId(i,r),t.some(function(e){return e.id===i&&e.namespace===r}))return A.error("Cyclical reference on fallback view configuration. Chain: {}",t),I.getDefaultView();if(e.isDirectlyAccessible())return e;t.push({id:i,namespace:r})}},this.setDataFetchAction=function(e){return"function"==typeof e?c=e:A.warn("Invalid argument. Type of 'Function' is required"),this},this.getDataFetchAction=function(){return c},this.fetchData=function(){var e=h.isPromiseSupported()&&!1;return"function"!=typeof c?e?Promise.resolve(void 0):{then:function(e,t){h.try2Call(e,null,void 0)}}:e?Promise(function(e,t){h.try2Call(c,null,e,t)}):{then:function(t,n){h.try2Call(c,null,function(e){h.try2Call(t,null,e)},function(e){h.try2Call(n,null,e)})}}},this.addTimer=function(e,t,n){if("function"==typeof e&&(n=t,t=e,e=h.randomString("timer")),h.isEmptyString(e,!0))throw new Error("Invalid argument. Timer name should not be empty");for(var i=String(e).trim().toLowerCase(),r=0;r<f.length;r++)if(f[r].name===i)throw new Error("Timer of name: '"+e+"' exists already");if("function"!=typeof t)throw new Error("Invalid argument. Timer handle should be of type: 'Function'");var a=Math.round(Number(n));if(isNaN(a)||a<1)throw new Error("Invalid arguemnt. Timer interval should be of type: 'Number' and be greater than 0");var o={name:i,handle:t,interval:n,timer:null};return f.push(o),this.isActive()&&(h.try2Call(t),o.timer=setInterval(function(){h.try2Call(t)},n)),this},this.startTimer=function(e){if(h.isEmptyString(e,!0))return!1;e=String(e).trim().toLowerCase();for(var t=0;t<f.length;t++){var n=f[t];if(n.name===e)return null===n.timer&&(h.try2Call(n.handle),n.timer=setInterval(function(e){return function(){h.try2Call(e)}}(n.handle),n.interval),!0)}return!1},this.startAllTimers=function(){for(var e=0;e<f.length;e++){var t=f[e];null===t.timer&&(h.try2Call(t.handle),t.timer=setInterval(function(e){return function(){h.try2Call(e)}}(t.handle),t.interval),t.timer=null)}return this},this.stopTimer=function(e){if(h.isEmptyString(e,!0))return!1;e=String(e).trim().toLowerCase();for(var t=0;t<f.length;t++){var n=f[t];if(n.name===e)return null!==n.timer&&(clearInterval(n.timer),!(n.timer=null))}return!1},this.stopAllTimers=function(){for(var e=0;e<f.length;e++){var t=f[e];clearInterval(t.timer),t.timer=null}return this},this.on("enter",function(){for(var e=0;e<f.length;e++){var t=f[e];h.try2Call(t.handle),t.timer=setInterval(function(e){return function(){h.try2Call(e)}}(t.handle),t.interval)}}),this.on("leave",function(){for(var e=0;e<f.length;e++){var t=f[e];clearInterval(t.timer),t.timer=null}})};e.set("ViewConstructor",I)}),View(function(e){var r,a,h=e.get("util"),t=e.get("eventDrive"),n=e.get("Logger"),o=e.get("touch"),s=e.get("layout"),w=e.get("ViewConstructor"),i=e.get("ViewContext"),p=e.get("ViewState"),l=e.get("OperationState"),u=(e.get("ViewLayout"),e.get("ChainedHandle")),m=e.get("viewRepresentation"),c=e.get("viewParameter"),v=e.get("viewAttribute"),y=e.get("viewInternalVariable"),b=n.globalLogger,f=null,g=[],d=document.title,S=!1,V=[],E=!1,A=[];t(w),w.SWITCHTYPE_HISTORYFORWARD="history.forward",w.SWITCHTYPE_HISTORYBACK="history.back",w.SWITCHTYPE_VIEWNAV="view.nav",w.SWITCHTYPE_VIEWCHANGE="view.change",w.SWITCHTRIGGER_APP="app",w.SWITCHTRIGGER_NAVIGATOR="navigator",w.currentState=null,w.Logger=n,w.layout=s,w.context=new i,w.checkIfBrowserHistorySupportsPushPopAction=function(){return h.env.isHistoryPushPopSupported},w.getViewContainerDomElement=y.getViewContainerDomElement,w.addSwitchInterceptor=function(e){if("function"!=typeof e)throw new Error("Invalid argument, type of 'Function' is required");return-1===g.indexOf(e)&&g.push(e),w},w.getSwitchInterceptors=function(){return g.concat()},w.find=function(e,t){return 1===arguments.length&&(t=e,e=w.getViewContainerDomElement()),null==e?null:e.querySelector(t)},w.findAll=function(e,t){return 1===arguments.length&&(t=e,e=w.getViewContainerDomElement()),null==e?null:e.querySelectorAll(t)},w.ofId=function(e,t){(arguments.length<2||h.isEmptyString(t,!0))&&(t=y.defaultNamespace),y.buildNamespace(t);for(var n=y.viewInstancesMap[t],i=0;i<n.length;i++)if(n[i].getId().trim()===e.trim()&&n[i].getNamespace().trim()===t.trim())return n[i];var r=new w(e,t);return n.push(r),r},w.ifExists=function(e,t){(arguments.length<2||h.isEmptyString(t,!0))&&(t=y.defaultNamespace),y.buildNamespace(t);for(var n=y.viewInstancesMap[t],i=0;i<n.length;i++)if(n[i].getId().trim()===e.trim())return!0;return!1},w.listAll=y.listAllViews,w.listAllViewNames=function(){return y.listAllViews().reduce(function(e,t){var n=t.getName();return h.isEmptyString(n,!0)||-1!==e.indexOf(n)||e.push(n.toLowerCase().trim()),e},[])},w.listAllGroups=function(){return b.warn("This method is deprecated, please use 'View.listAllViewNames()' instead"),w.listAllViewNames()},w.setAsDefault=function(e,t){if((arguments.length<2||h.isEmptyString(t,!0))&&(t=y.defaultNamespace),y.buildNamespace(t),h.isEmptyString(e,!0))return b.warn("No view id supplied to set as default"),w;for(var n=y.getViewDomElements(),i=0;i<n.length;i++)n[i].removeAttribute(v.attr$view_default);var r=y.getViewDomElementOfId(e,t);return null==r?b.error("No dom element for view of id: '{}' namespace: '{}' found to set as default",e,t):r.setAttribute(v.attr$view_default,"true"),w},w.isDirectlyAccessible=function(){var e,t=v.attr$view_directly_accessible,n=w.getViewContainerDomElement().getAttribute(t),i=document.documentElement.getAttribute(t);if(null===n){if(null===i)return!1;e=i,b.warn("Declaring view attribute: '{}' in <html> element is deprecated, you should declare in the view container's dom element",t)}else null===i?e=n:(e=n,b.warn("Found view attribute: '{}' in the view container's dom element, ingoring the one declared in <html> element",t));return h.ifStringEqualsIgnoreCase("true",e)},w.setIsDirectlyAccessible=function(e){return w.getViewContainerDomElement().setAttribute(v.attr$view_directly_accessible,String(!!e).toLowerCase()),w},w.setViewIsDirectlyAccessible=function(e,t,n){if(arguments.length<2)throw new Error("Illegal argument length. Call with arguments: 'viewId[, viewNamespace], accessible'");arguments.length<3&&(n=t,t=y.defaultNamespace);var i=y.getViewDomElementOfId(e,t);return null==i?b.error("No view of id: {}, namespace: {} found to set is directly accessible or not",e,t):i.setAttribute(v.attr$view_directly_accessible,String(!!n).toLowerCase()),w},w.getActiveView=function(){for(var e=y.listAllViews(),t=0;t<e.length;t++)if(e[t].isActive())return e[t];return null},w.getDefaultView=function(){for(var e=y.listAllViews(),t=0;t<e.length;t++)if(e[t].isDefault())return e[t];return null},w.setSwitchAnimation=function(e){if(!(e instanceof Function))throw new Error("Invalid argument, type of 'Function' is required");return y.viewSwitchAnimation=e,w},w.getSwitchAnimation=function(){return y.viewSwitchAnimation},w.getActiveViewOptions=function(){var e=m.parseViewInfoFromHash(location.hash);return null==e?null:e.options},w.hasActiveViewOption=function(e){var t=w.getActiveViewOptions();return null!=t&&e in t},w.getActiveViewOption=function(e){var t=w.getActiveViewOptions();return null==t?null:t[e]},w.setActiveViewOption=function(e,t){if(h.isEmptyString(e,!0))return b.error("Option name should not be empty"),w;var n=w.getActiveView();if(null==n)return b.error("No view is active to set option {} = {}",e,t),w;e=String(e).trim(),t=String(t).trim();var i=w.getActiveViewOptions()||{};return i[e]=t,p.replaceViewState(n.id,n.namespace,w.currentState?w.currentState.sn:null,i),w};function I(e,t,n){if(arguments.length<3&&(n="nav"),(arguments.length<2||"string"!=typeof t||h.isEmptyString(t,!0))&&(t=y.defaultNamespace),y.buildNamespace(t),h.ifStringEqualsIgnoreCase(m.PSVIEW_DEFAULT,e)){var i=w.getDefaultView();if(null==i)return b.error("No default view found"),w;e=i.id,t=i.namespace}if(/^~/.test(e)){var r=e.substring(1),a=y.findFirstViewOfName(r);if(null==a)return w;e=a.id,t=a.namespace}return w.ifExists(e,t)?p["nav"===n?"pushViewState":"replaceViewState"](e,t):console.error(new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist!")),w}w.navBy=function(e,t,n){return I(e,t,"nav"),w},w.passBy=function(e,t,n){return b.warn("This method is deprecated, and it will be removed someday in the future, please use 'View.navBy()' instead"),I(e,t,"nav"),w},w.changeBy=function(e,t,n){return I(e,t,"change"),w},w.getChainedHandleByName=function(e){return b.warn("This method is deprecated, and it will be removed someday in the future"),u.ofName(e)},w.navTo=function(e,t,n){e instanceof w?(n=t,t=e.namespace,e=e.id):(arguments.length<2||"string"!=typeof t||h.isEmptyString(t,!0))&&(n=t,t=y.defaultNamespace),y.buildNamespace(t),e=e.trim(),n=h.setDftValue(n,{});w.getActiveView();if(h.ifStringEqualsIgnoreCase(m.PSVIEW_BACK,e))return w.back(n),w;if(h.ifStringEqualsIgnoreCase(m.PSVIEW_FORWARD,e))return w.forward(n),w;if(h.ifStringEqualsIgnoreCase(m.PSVIEW_DEFAULT,e)){var i=w.getDefaultView();if(null==i)return b.error("No default view found"),w;e=i.id,t=i.namespace}if(/^\s*~/.test(e)){var r=e.replace(/^\s*~+/,"").trim(),a=y.findFirstViewOfName(r);if(null==a)return w;e=a.id,t=a.namespace}if(/^(http|https|ftp):\/\//gim.test(e))return window.location.assign(e),w;if(/^\s*@+/.test(e)){var o=e.replace(/^\s*@+/,"").trim();return""===o?void b.warn("Empty target: '{}'",e):(window.location.assign(o),w)}if(w.ifExists(e,t))return n.type=w.SWITCHTYPE_VIEWNAV,n.trigger=w.SWITCHTRIGGER_APP,n.onbeforeswitch=function(){p.pushViewState(e,t,null,null==n?null:n.options)},y.intendedSwitchType=w.SWITCHTYPE_VIEWNAV,y.showView(e,t,n),w;b.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options);var s=new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist! Firing event 'viewnotexist'...");return console.error(s),w.fire("viewnotexist",{targetViewId:e,targetViewNamespace:t}),w},w.changeTo=function(e,t,n){e instanceof w?(n=t,t=e.namespace,e=e.id):(arguments.length<2||"string"!=typeof t||h.isEmptyString(t,!0))&&(n=t,t=y.defaultNamespace),y.buildNamespace(t),n=h.setDftValue(n,{});w.getActiveView();if(h.ifStringEqualsIgnoreCase(m.PSVIEW_DEFAULT,e)){var i=w.getDefaultView();if(null==i)return void b.error("No default view found");e=i.id,t=i.namespace}if(/^\s*~/.test(e)){var r=e.replace(/^\s*~+/,"").trim(),a=y.findFirstViewOfName(r);if(null==a)return w;e=a.id,t=a.namespace}if(/^(http|https|ftp):\/\//gim.test(e))return window.location.replace(e),w;if(/^\s*@+/.test(e)){var o=e.replace(/^\s*@+/,"").trim();return""===o?void b.warn("Empty target: '{}'",e):(window.location.replace(o),w)}if(w.ifExists(e,t))return n.type=w.SWITCHTYPE_VIEWCHANGE,n.trigger=w.SWITCHTRIGGER_APP,n.onbeforeswitch=function(){p.replaceViewState(e,t,null,null==n?null:n.options)},y.intendedSwitchType=w.SWITCHTYPE_VIEWCHANGE,y.showView(e,t,n),w;b.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options);var s=new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist! Firing event 'viewnotexist'...");return console.error(s),w.fire("viewnotexist",{targetViewId:e,targetViewNamespace:t}),w},w.setNoViewToNavBackAction=function(e){if("function"!=typeof e)throw new Error("Invalid argument! Type of 'Function' is required");return f=e,w},w.back=function(e){return y.intendedSwitchType=w.SWITCHTYPE_HISTORYBACK,c.clearViewParameters(m.PSVIEW_BACK,""),null!=e&&"params"in e&&c.setViewParameters(m.PSVIEW_BACK,"",e.params),w.ifCanGoBack()||"function"!=typeof f?history.go(-1):h.try2Call(f),w},w.forward=function(e){return y.intendedSwitchType=w.SWITCHTYPE_HISTORYFORWARD,c.clearViewParameters(m.PSVIEW_FORWARD,""),null!=e&&"params"in e&&c.setViewParameters(m.PSVIEW_FORWARD,"",e.params),history.go(1),w},w.setDocumentTitle=function(e){return h.isEmptyString(e,!0)?b.warn("Invalid document title: "+e):document.title=d=e,w},w.onceHistoryBack=function(e){if(b.warn("This method is deprecated, and it will be removed someday in the future"),"function"!=typeof e)throw new Error("Invalid argument! Type of 'Function' is required");return l.pushState(h.randomString(),e),w},w.reDoLayout=function(){return y.listAllViews().forEach(function(e){h.try2Call(e.getLayoutAction())}),w},w.ifCanGoBack=p.ifCanGoBack,w.beforeInit=function(e){return"function"!=typeof e?b.warn("Type of 'Function' is required"):S?b.warn("View.js is initialized already"):-1===V.indexOf(e)&&V.push(e),w},w.ready=function(e){return"function"!=typeof e?b.warn("Type of 'Function' is required"):E?h.try2Call(e):-1===A.indexOf(e)&&A.push(e),w},w.setInitializer=function(e,t){if("function"==typeof e){var n="domready";arguments.length<2&&(t=n);var i="domready, rightnow".split(/\s*,\s*/);-1===i.indexOf(t)&&(b.warn("Unknown initializer exec time: {}. Supported: {}",t,i),t=n),r=e,a=t,S||"rightnow"!==t||(b.info("Calling specified view initializer right now"),e(P))}};function C(e){var t=w.getActiveView(),n=null,i=null;null!=t&&(n=t.getId(),i=t.getNamespace()),b.log("{} Current: {}",h.env.isHistoryPushPopSupported?"State popped!":"Hash changed!",t&&t.getId()),b.log("↑ {}",h.env.isHistoryPushPopSupported?JSON.stringify(e.state):location.hash);var r=null,a=null,o=null,s=null,l=null,u=w.SWITCHTYPE_VIEWNAV,c=null;if(null==e.state){u=w.SWITCHTYPE_VIEWNAV;var f=m.parseViewInfoFromHash(location.hash);if(null==f?(o=n,s=i,l=t):(r=f.viewId,a=f.viewNamespace,o=r,s=a,w.ifExists(o,s)&&(l=w.ofId(o,s))),null!=o&&null!=l){var g=o===r&&s===a;c=o===n&&s===i?w.currentState?w.currentState.options:null:g?f.options:null,y.showView(o,s,{type:u,trigger:w.SWITCHTRIGGER_APP,options:c,onbeforeswitch:function(){p.replaceViewState(o,s,null,c)}})}}else if(p.isConstructorOf(e.state)){var d=e.state;r=d.viewId,a=d.viewNamespace,c=w.ifExists(r,a)?(l=w.ofId(r,a),d.options):(b.warn("Popped view: '"+r+"' within namespace: '"+a+"' does not exist, keeping current"),l=t,null),o=l.getId(),s=l.getNamespace(),null!=w.currentState&&(u=d.sn<w.currentState.sn?w.SWITCHTYPE_HISTORYBACK:w.SWITCHTYPE_HISTORYFORWARD),y.showView(o,s,{type:u,trigger:null!=y.intendedSwitchType?w.SWITCHTRIGGER_APP:w.SWITCHTRIGGER_NAVIGATOR,options:c,onbeforeswitch:function(){p.replaceViewState(o,s,d.sn,c)}})}else b.info("Skip state: {}",e.state)}var P=function(){!function(){for(var e=0;e<V.length;e++)h.try2Call(V[e]);V=[]}(),d=document.title,document.documentElement.setAttribute(v.attr$view_os,h.env.isIOS?"ios":h.env.isAndroid?"android":h.env.isWindowsPhone?"wp":"unknown"),window.addEventListener(h.env.isHistoryPushPopSupported?"popstate":"hashchange",C),function(){var e=document.querySelectorAll("["+v.attr$view_container+"]");if(0===e.length)document.body.setAttribute(v.attr$view_container,"");else for(var t=1;t<e.length;t++)e[t].removeAttribute(v.attr$view_container)}(),w.getViewContainerDomElement().setAttribute(v.attr$view_state,"initing");var i=y.getViewDomElements(),r=[];[].forEach.call(i,function(t){var e=t.getAttribute(v.attr$view_namespace);h.isEmptyString(e,!0)&&(e=y.defaultNamespace,t.setAttribute(v.attr$view_namespace,e));var n=y.getPotentialViewId(t),i=w.ofId(n,e);-1===r.indexOf(i)?(r.push(i),h.removeClass(t,"active"),h.addClass(t,"view"),i.on("enter",function(){var e=t.getAttribute(v.attr$view_title);document.title=null==e?d:e})):b.warn("Multiple view of id: '{}' within namespace: '{}' exists",i.id,i.namespace)});var f=null;null!=(f=function(){for(var e=null,t=-1,n=0;n<i.length;n++)if("true"===i[n].getAttribute(v.attr$view_default)){t=n;break}if(-1!==t){e=i[t];for(n=t+1;n<i.length;n++)"true"===i[n].getAttribute(v.attr$view_default)&&i[n].removeAttribute(v.attr$view_default)}else 0!==i.length?(e=i[0]).setAttribute(v.attr$view_default,"true"):b.warn("No view exists to serve as default view");return e}())&&h.addClass(f,"active"),o.addTapListener(document.documentElement,function(e){for(var t,n=e.changedTouches?e.changedTouches[0].target:e.target,i=y.defaultNamespace,r=n;null==r.getAttribute(v.attr$view_rel)&&((r=r.parentNode)instanceof HTMLElement||(r=null),null!=r););if((null!=r&&(t=r.getAttribute(v.attr$view_rel),i=r.getAttribute(v.attr$view_rel_namespace)),h.isEmptyString(i,!0)&&(i=y.defaultNamespace),null!=t&&""!==t.trim())&&!("true"===r.getAttribute(v.attr$view_rel_disabled)))if(e.preventDefault(),/^(http|https|ftp):\/\//gim.test(t))window.location.href=t;else{if(/^\s*@+/.test(t)){var a=t.replace(/^\s*@+/,"").trim();return""===a?void b.warn("Empty file path for data-view-rel: '{}'",t):void(window.location.href=a)}if(h.ifStringEqualsIgnoreCase(m.PSVIEW_BACK,t))w.back();else if(h.ifStringEqualsIgnoreCase(m.PSVIEW_FORWARD,t))w.forward();else{if(h.ifStringEqualsIgnoreCase(m.PSVIEW_DEFAULT,t)){var o=w.getDefaultView();null!=o&&(t=o.id,i=o.namespace)}var s=null;if(/^~/.test(t)){var l=t.match(/^~([^!]+)(?:!+(.*))?/);if(null==l)return;var u=l[1].trim(),c=h.parseParams(l[2]),f=y.findFirstViewOfName(u);if(null==f)return;t=f.id,i=f.namespace,s=c}else{var g=m.parseViewInfoFromHash("#"+t);h.isEmptyString(g.specifiedViewNamespace,!0)||(i=g.specifiedViewNamespace),t=g.viewId,s=g.options}var d=r.getAttribute(v.attr$view_rel_type);d=h.isEmptyString(d,!0)?"nav":d,/^(?:nav)|(?:change)$/.test(d)||(b.warn("Unknown view switch type: {}. {}",d,r),d="nav"),w[d+"To"](t,i,{options:s})}}},{useCapture:!0}),function(){h.blurInputs();var e=w.getViewContainerDomElement().getAttribute(v.attr$view_whr);if(null!=e&&""!==(e=e.trim().toLowerCase())||null!=(e=document.documentElement.getAttribute(v.attr$view_whr))&&""!==(e=e.trim().toLowerCase())&&b.warn("Declaring view attribute: '{}' in <html> element is deprecated, you should declare in the view container's dom element",v.attr$view_whr),null!=e&&""!==(e=e.trim().toLowerCase())){if("unlimited"!==e){var t=/(\d+(?:\.\d*)?)\s*\/\s*(\d+(?:\.\d*)?)/i,n=e.match(t);null==n?(b.warn("Invalid view expected width height ratio: {}. Value such as '320/568'(iPhone 5) is valid. Using '{}' instead",e,y.defaultWidthHeightRatio),n=y.defaultWidthHeightRatio.exec(t)):b.info("Using specified expected width height ratio: {}",e),s.setExpectedWidthHeightRatio(Number(n[1])/Number(n[2])).init(),s.doLayout(!1)}}else s.init().doLayout(!1)}(),b.info("Marking View as initialized and ready"),S=!0,function(){E=!0;for(var e=0;e<A.length;e++)h.try2Call(A[e]);A=[],w.getViewContainerDomElement().setAttribute(v.attr$view_state,"ready")}(),function(){if(null==w.currentState){var e=null==f?null:y.getPotentialViewId(f),t=null==f?null:f.getAttribute(v.attr$view_namespace)||y.defaultNamespace,n=m.parseViewInfoFromHash(location.hash),i=null==n?null:n.viewId,r=null==n?null:n.viewNamespace,a=null==n?null:n.options,o=null,s=null,l=h.isEmptyString(e,!0);if(h.isEmptyString(i,!0)?l?s=o=null:w.ifExists(e,t)?(o=e,s=t):b.warn("No default view of id: '{}' within namespace: '{}' found",e,t):w.ifExists(i,r)?(o=i,s=r):b.warn("No view of id: '{}' namespace: '{}'(specified in the location hash) found, trying to show the default view",i,r),!h.isEmptyString(o,!0)){var u=y.getFinalView(o,s);if(null!=u){o=u.getId(),s=u.getNamespace(),o===i&&s===r||(a=null),b.info("Showing view: '{}' within namespace: '{}'",o,s);var c=w.getActiveView();y.switchView({srcView:c===u?null:c,targetView:u,withAnimation:!1,params:null,onbeforeswitch:function(){p.replaceViewState(o,s,null,a)}})}else b.error("No final view found for view of id: '{}', namespace: '{}'",o,s)}}else b.debug("Skip showing specified view")}()};document.addEventListener("DOMContentLoaded",function(){null==r?(b.info("Initializing View.js automatically"),P()):"domready"===a&&(b.info("Calling specified View.js initializer"),r(P))}),e.expose(w)});